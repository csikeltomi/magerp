ESX=nil;local a,b,c,d=nil,{},{},{}local e=100;local f;local g=0;local h=0;local i=false;local j=nil;local k,l,m,n=false,false,false,false;Citizen.CreateThread(function()while true do if a~=nil then local o=GetEntityCoords(a,false)local p=vector3(o.x,o.y,o.z-5)-o;if#(GetEntityCoords(a)-GetEntityCoords(PlayerPedId()))<20 then local q,r,s=table.unpack(GetEntityCoords(a))if h=='mana'then DrawMarker(25,q,r,s-GetEntityHeightAboveGround(a)/2,0.0,0.0,0.0,0.0,0.0,0.0,10.0,10.0,10.0,0,0,128,50,false,false,2,false,false,false,false)elseif h=='health'then DrawMarker(25,GetEntityCoords(a),0.0,0.0,0.0,0.0,0.0,0.0,10.0,10.0,10.0,0,128,0,50,false,false,2,false,false,false,false)end end;if#(GetEntityCoords(a)-GetEntityCoords(PlayerPedId()))<=7 then local t=""local u="Eleterö: "..GetEntityHealth(a)if h=='mana'then t="~b~+ 0.5 Varázsarö/másodperc"elseif h=='health'then t="~g~+ 0.5 Életerö/másodperc"end;SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.2)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(t)DrawText(0.50,0.85)SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.2)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(u)DrawText(0.50,0.87)end end;Wait(0)end end)RegisterNetEvent('animal:Resurrect')AddEventHandler('animal:Resurrect',function()if a~=nil then local v=GetEntityCoords(PlayerPedId())TaskGoToCoordAnyMeans(a,v.x,v.y,v.z,5.0,0,0,786603,0xbf800000)if#(GetEntityCoords(a)-GetEntityCoords(PlayerPedId()))<10 then print("RESURRECT")TriggerServerEvent('esx_ambulancejob:revive',GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1))))SetEntityHealth(a,0)TriggerServerEvent('Magic:SyncParticle2',"proj_indep_firework_v2","scr_firework_indep_burst_rwb",v.x,v.y,v.z,0,255,0)end end end)Citizen.CreateThread(function()while true do if a~=nil then if GetEntityHealth(a)==0 and not i then TriggerServerEvent('eden_animal:petDied')DeleteEntity(a)Wait(100)a=nil;ESX.ShowNotification(_U('pet_dead'))g=0;e="die"end end;if#(GetEntityCoords(a)-GetEntityCoords(PlayerPedId()))>200 then local w=GetPlayerGroup(PlayerId())SetGroupSeparationRange(w,1.9)SetPedNeverLeavesGroup(a,false)i=true;DeleteEntity(a)end;Wait(1000)end end)Citizen.CreateThread(function()while true do if a~=nil then if#(GetEntityCoords(a)-GetEntityCoords(PlayerPedId()))<10 then if h=='mana'then TriggerEvent("Magic:AddMana",1.0)elseif h=='health'then TriggerEvent("Magic:AddHealth",1.0)end end end;Wait(1000)end end)Citizen.CreateThread(function()while ESX==nil do TriggerEvent('esx:getSharedObject',function(x)ESX=x end)Citizen.Wait(0)end;Citizen.Wait(5000)DoRequestModel(-1788665315)DoRequestModel(1462895032)DoRequestModel(1682622302)DoRequestModel(-541762431)DoRequestModel(1318032802)DoRequestModel(-1323586730)DoRequestModel(1125994524)DoRequestModel(1832265812)DoRequestModel(882848737)DoRequestModel(1126154828)DoRequestModel(-1384627013)DoRequestModel(351016938)end)function OpenPetMenu()local y={}if g==1 then table.insert(y,{label=_U('attachpet'),value='attached_animal'})if isInVehicle then table.insert(y,{label=_U('getpeddown'),value='vehicle'})else table.insert(y,{label=_U('getpedinside'),value='vehicle'})end;table.insert(y,{label=_U('giveorders'),value='give_orders'})else table.insert(y,{label=_U('callpet'),value='come_animal'})end;ESX.UI.Menu.CloseAll()ESX.UI.Menu.Open('default',GetCurrentResourceName(),'pet_menu',{title=_U('pet_management'),align='bottom-right',elements=y},function(t,z)if t.current.value=='come_animal'and g==0 then ESX.TriggerServerCallback('eden_animal:getPet',function(A)if A=='chien'then b=-1788665315;g=1;h='health'openchien()elseif A=='chat'then b=1462895032;g=1;h='mana'openchien()elseif A=='loup'then b=1682622302;g=1;h='mana'openchien()elseif A=='lapin'then b=-541762431;g=1;h='health'openchien()elseif A=='husky'then b=1318032802;g=1;h='mana'openchien()elseif A=='caniche'then b=1125994524;g=1;h='mana'openchien()elseif A=='carlin'then b=1832265812;g=1;h='mana'openchien()elseif A=='retriever'then b=882848737;g=1;h='health'openchien()elseif A=='berger'then b=1126154828;g=1;h='health'openchien()elseif A=='westie'then b=-1384627013;g=1;h='health'openchien()elseif A=='rottweiler'then h='mana'b=351016938;g=1 else print('eden_animal: unknown pet '..A)end end)z.close()elseif t.current.value=='attached_animal'then if not IsPedSittingInAnyVehicle(a)then if k==false then attached()k=true else detached()k=false end else ESX.ShowNotification(_U('dontattachhiminacar'))end elseif t.current.value=='give_orders'then GivePetOrders()elseif t.current.value=='vehicle'then local B=PlayerPedId()local C=GetVehiclePedIsUsing(B)local D=GetEntityCoords(B)local E=GetEntityCoords(a)local F=GetDistanceBetweenCoords(D,E,true)if not isInVehicle then if IsPedSittingInAnyVehicle(B)then if F<8 then attached()Citizen.Wait(200)if IsVehicleSeatFree(C,1)then SetPedIntoVehicle(a,C,1)isInVehicle=true elseif IsVehicleSeatFree(C,2)then isInVehicle=true;SetPedIntoVehicle(a,C,2)elseif IsVehicleSeatFree(C,0)then isInVehicle=true;SetPedIntoVehicle(a,C,0)end;z.close()else ESX.ShowNotification(_U('toofarfromcar'))end else ESX.ShowNotification(_U('youneedtobeincar'))end else if not IsPedSittingInAnyVehicle(B)then SetEntityCoords(a,D,1,0,0,1)Citizen.Wait(100)detached()isInVehicle=false;z.close()else ESX.ShowNotification(_U('yourstillinacar'))end end end end,function(t,z)z.close()end)end;function GivePetOrders()ESX.TriggerServerCallback('eden_animal:getPet',function(A)local y={}if not m then if A~='chat'then end;table.insert(y,{label=_U('pied'),value='pied'})table.insert(y,{label=_U('follow'),value='follow'})table.insert(y,{label=_U('stay'),value='stay'})table.insert(y,{label=_U('doghouse'),value='return_doghouse'})if A=='chien'then table.insert(y,{label=_U('sitdown'),value='assis'})table.insert(y,{label=_U('getdown'),value='coucher'})elseif A=='chat'then table.insert(y,{label=_U('getdown'),value='coucher2'})elseif A=='loup'then table.insert(y,{label=_U('getdown'),value='coucher3'})elseif A=='carlin'then table.insert(y,{label=_U('sitdown'),value='assis2'})elseif A=='retriever'then table.insert(y,{label=_U('sitdown'),value='assis3'})elseif A=='rottweiler'then table.insert(y,{label=_U('sitdown'),value='assis4'})end else table.insert(y,{label=_U('getup'),value='debout'})end;ESX.UI.Menu.Open('default',GetCurrentResourceName(),'give_orders',{title=_U('pet_orders'),align='bottom-right',elements=y},function(t,z)if t.current.value=='return_doghouse'then local w=GetPlayerGroup(PlayerId())local D=GetEntityCoords(PlayerPedId())ESX.ShowNotification(_U('doghouse_returning'))SetGroupSeparationRange(w,1.9)SetPedNeverLeavesGroup(a,false)TaskGoToCoordAnyMeans(a,D.x+40,D.y,D.z,5.0,0,0,786603,0xbf800000)i=true;Citizen.Wait(5000)DeleteEntity(a)g=0;ESX.UI.Menu.CloseAll()elseif t.current.value=='pied'then local D=GetEntityCoords(PlayerPedId())z.close()elseif t.current.value=='follow'then TaskFollowToOffsetOfEntity(a,PlayerPedId(),0.5,0.0,0.0,5.0,-1,0.0,1)z.close()z.close()elseif t.current.value=='stay'then ClearPedTasksImmediately(a)z.close()elseif t.current.value=='balle'then local G=GetEntityCoords(a)c=GetClosestObjectOfType(G,190.0,GetHashKey('w_am_baseball'))if DoesEntityExist(c)then n=true;f=GetEntityCoords(c)TaskGoToCoordAnyMeans(a,f,5.0,0,0,786603,0xbf800000)local w=GetPlayerGroup(PlayerId())SetGroupSeparationRange(w,1.9)SetPedNeverLeavesGroup(a,false)z.close()else ESX.ShowNotification(_U('noball'))end elseif t.current.value=='assis'then DoRequestAnimSet('creatures@rottweiler@amb@world_dog_sitting@base')TaskPlayAnim(a,'creatures@rottweiler@amb@world_dog_sitting@base','base',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='coucher'then DoRequestAnimSet('creatures@rottweiler@amb@sleep_in_kennel@')TaskPlayAnim(a,'creatures@rottweiler@amb@sleep_in_kennel@','sleep_in_kennel',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='coucher2'then DoRequestAnimSet('creatures@cat@amb@world_cat_sleeping_ground@idle_a')TaskPlayAnim(a,'creatures@cat@amb@world_cat_sleeping_ground@idle_a','idle_a',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='coucher3'then DoRequestAnimSet('creatures@coyote@amb@world_coyote_rest@idle_a')TaskPlayAnim(a,'creatures@coyote@amb@world_coyote_rest@idle_a','idle_a',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='assis2'then DoRequestAnimSet('creatures@carlin@amb@world_dog_sitting@idle_a')TaskPlayAnim(a,'creatures@carlin@amb@world_dog_sitting@idle_a','idle_b',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='assis3'then DoRequestAnimSet('creatures@retriever@amb@world_dog_sitting@idle_a')TaskPlayAnim(a,'creatures@retriever@amb@world_dog_sitting@idle_a','idle_c',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='assis4'then DoRequestAnimSet('creatures@rottweiler@amb@world_dog_sitting@idle_a')TaskPlayAnim(a,'creatures@rottweiler@amb@world_dog_sitting@idle_a','idle_c',8.0,-8,-1,1,0,false,false,false)m=true;z.close()elseif t.current.value=='debout'then ClearPedTasks(a)m=false;z.close()end end,function(t,z)z.close()end)end)end;Citizen.CreateThread(function()while true do Citizen.Wait(30)if n then local H=GetEntityCoords(PlayerPedId())local E=GetEntityCoords(a)local F=GetDistanceBetweenCoords(f,E,true)local I=GetDistanceBetweenCoords(H,E,true)if F<0.5 then local J=GetPedBoneIndex(a,17188)AttachEntityToEntity(c,a,J,0.120,0.010,0.010,5.0,150.0,0.0,true,true,false,true,1,true)TaskGoToCoordAnyMeans(a,H,5.0,0,0,786603,0xbf800000)n=false;l=true end end;if l then local H=GetEntityCoords(PlayerPedId())local E=GetEntityCoords(a)local I=GetDistanceBetweenCoords(H,E,true)if I<1.5 then DetachEntity(c,false,false)Citizen.Wait(50)SetEntityAsMissionEntity(c)DeleteEntity(c)GiveWeaponToPed(PlayerPedId(),GetHashKey("WEAPON_BALL"),1,false,true)local w=GetPlayerGroup(PlayerId())SetGroupSeparationRange(w,999999.9)SetPedNeverLeavesGroup(a,true)SetPedAsGroupMember(a,w)l=false end end end end)function attached()local w=GetPlayerGroup(PlayerId())SetGroupSeparationRange(w,1.9)SetPedNeverLeavesGroup(a,false)FreezeEntityPosition(a,true)end;function detached()local w=GetPlayerGroup(PlayerId())SetGroupSeparationRange(w,999999.9)SetPedNeverLeavesGroup(a,true)SetPedAsGroupMember(a,w)FreezeEntityPosition(a,false)end;function openchien()local B=PlayerPedId()local K=GetEntityCoords(B)local w=GetPlayerGroup(PlayerId())DoRequestAnimSet('rcmnigel1c')TaskPlayAnim(B,'rcmnigel1c','hailing_whistle_waive_a',8.0,-8,-1,120,0,false,false,false)Citizen.SetTimeout(5000,function()a=CreatePed(28,b,K.x+1,K.y+1,K.z-1,1,1)SetBlockingOfNonTemporaryEvents(a,true)SetPedAsGroupLeader(B,w)SetPedAsGroupMember(a,w)SetPedNeverLeavesGroup(a,true)SetPedCanBeTargetted(a,false)SetEntityAsMissionEntity(a,true,true)SetPedCanRagdollFromPlayerImpact(a,false)SetPedCanRagdoll(a,false)SetPedConfigFlag(a,430,true)SetPedConfigFlag(a,456,false)SetPedConfigFlag(a,294,true)SetPedDiesWhenInjured(a,false)SetEntityHealth(a,GetPedMaxHealth(PlayerPedId())*3)e=math.random(40,90)i=false;Citizen.Wait(5)attached()Citizen.Wait(5)detached()TaskFollowToOffsetOfEntity(a,PlayerPedId(),0.5,0.0,0.0,5.0,-1,2.0,1)local j=AddBlipForEntity(a)SetBlipSprite(j,463)SetBlipDisplay(j,4)SetBlipScale(j,0.7)SetBlipColour(j,3)SetBlipAsShortRange(j,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString("Kisállat")EndTextCommandSetBlipName(j)end)end;Citizen.CreateThread(function()while true do Citizen.Wait(0)if IsControlJustPressed(0,168)and GetLastInputMethod(2)and not ESX.UI.Menu.IsOpen('default',GetCurrentResourceName(),'pet_menu')then OpenPetMenu()end end end)Citizen.CreateThread(function()local j=AddBlipForCoord(Config.Zones.PetShop.Pos.x,Config.Zones.PetShop.Pos.y,Config.Zones.PetShop.Pos.z)SetBlipSprite(j,Config.Zones.PetShop.Sprite)SetBlipDisplay(j,Config.Zones.PetShop.Display)SetBlipScale(j,Config.Zones.PetShop.Scale)SetBlipAsShortRange(j,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString(_U('pet_shop'))EndTextCommandSetBlipName(j)end)Citizen.CreateThread(function()while true do Citizen.Wait(0)local L=GetEntityCoords(PlayerPedId())if GetDistanceBetweenCoords(L,Config.Zones.PetShop.Pos.x,Config.Zones.PetShop.Pos.y,Config.Zones.PetShop.Pos.z,true)<2 then ESX.ShowHelpNotification(_U('enterkey'))if IsControlJustReleased(0,38)then OpenPetShop()end else Citizen.Wait(500)end end end)function OpenPetShop()local y={}ESX.TriggerServerCallback("eden_animal:getAnimals",function(M)for N=1,#M,1 do table.insert(y,{label=('%s - <span style="color:green;">%s</span>'):format(M[N].label,_U('shop_item',ESX.Math.GroupDigits(M[N].price))),pet=M[N].pet,price=M[N].price})end;ESX.UI.Menu.Open('default',GetCurrentResourceName(),'pet_shop',{title=_U('pet_shop'),align='bottom-right',elements=y},function(t,z)ESX.TriggerServerCallback('eden_animal:buyPet',function(O)if O then z.close()end end,t.current.pet)end,function(t,z)z.close()end)end)end;function DoRequestModel(b)RequestModel(b)while not HasModelLoaded(b)do Citizen.Wait(1)end end;function DoRequestAnimSet(P)RequestAnimDict(P)while not HasAnimDictLoaded(P)do Citizen.Wait(1)end end
