local a=true;local b={[1]={name="Reptér",StartCoords=vector3(-1345.7547607422,-2226.869140625,13.944828987122),CP=vector3(-1337.5985107422,-2243.4348144531,13.944826126099),Heading=147.3,blip=nil,vehicle='akuma',Waypoints={vector3(-1649.8977050781,-2986.8505859375,178.66003417969),vector3(-1248.5249023438,-3210.3029785156,170.45356750488),vector3(-988.47802734375,-3199.4792480469,166.71670532227),vector3(-862.76947021484,-3132.6008300781,175.26997375488),vector3(-570.40106201172,-2917.6821289063,198.49295043945),vector3(-266.01467895508,-2673.458984375,191.18907165527),vector3(-141.31135559082,-2653.0268554688,110.8648223877),vector3(-35.0051612854,-2628.1955566406,30.461864471436),vector3(3.0410511493683,-2619.6745605469,13.088755607605),vector3(97.783325195313,-2599.2026367188,24.561668395996),vector3(356.1455078125,-2506.4909667969,62.427062988281),vector3(562.51275634766,-2449.6391601563,57.854434967041),vector3(753.33721923828,-2377.4404296875,45.047199249268),vector3(789.60894775391,-2361.2309570313,44.134971618652),vector3(924.68103027344,-2323.2702636719,56.399730682373),vector3(1305.9061279297,-2264.1511230469,109.04692840576),vector3(1680.3433837891,-2346.6843261719,142.85733032227),vector3(1689.4808349609,-2575.052734375,118.61140441895),vector3(1531.5026855469,-2825.2055664063,78.948860168457),vector3(1385.4085693359,-3017.1079101563,45.27978515625),vector3(1296.7283935547,-3156.1877441406,20.858371734619),vector3(1210.7705078125,-3216.6945800781,10.340401649475),vector3(1138.9597167969,-3219.1823730469,6.6497206687927)}},[2]={name="Drift",StartCoords=vector3(-2656.3759765625,1507.2407226563,116.9133682251),CP=vector3(-2645.6145019531,1502.8939208984,119.44950866699),Heading=328.63,blip=nil,vehicle='variszupra',Waypoints={vector3(-2644.6071777344,1526.3157958984,118.54657745361),vector3(-2636.1235351563,1610.1177978516,127.10390472412),vector3(-2540.0258789063,1670.4920654297,147.03897094727),vector3(-2500.5485839844,1718.9582519531,155.34226989746),vector3(-2469.818359375,1786.4858398438,159.59745788574),vector3(-2539.7690429688,1877.5240478516,166.77801513672),vector3(-2498.8100585938,1946.8580322266,172.5926361084),vector3(-2399.7766113281,1942.7862548828,179.81826782227),vector3(-2309.7043457031,1866.6625976563,182.55323791504),vector3(-2215.4011230469,1920.5120849609,187.97639465332),vector3(-2115.9260253906,1995.5270996094,190.44227600098),vector3(-2043.3525390625,1976.1077880859,189.31221008301),vector3(-1976.4116210938,1906.4555664063,185.56965637207),vector3(-1997.2683105469,1774.6306152344,179.96586608887),vector3(-1889.3195800781,1784.1359863281,169.07054138184),vector3(-1790.1597900391,1857.3140869141,151.78186035156),vector3(-1853.2957763672,1952.8695068359,144.6277923584),vector3(-1861.4360351563,2025.9591064453,138.15525817871),vector3(-1727.1375732422,2103.1784667969,113.95411682129),vector3(-1675.6331787109,2225.9768066406,86.193641662598),vector3(-1787.4537353516,2302.0871582031,71.865386962891),vector3(-1935.8491210938,2295.0939941406,57.030529022217),vector3(-2094.37890625,2298.4011230469,37.794357299805)}}}local c=0;local d=nil;local e=nil;local f=10;local g=nil;local h=nil;RegisterNetEvent("MagicGame:Race")AddEventHandler("MagicGame:Race",function(i)if d~=nil then return end;local j=tonumber(i)e=b[j]g=j;SetEntityCoords(GetPlayerPed(-1),e.StartCoords,true,false,false,false)SetEntityHeading(GetPlayerPed(-1),e.Heading)ESX.Game.SpawnVehicle(e.vehicle,e.StartCoords,e.Heading,function(k)SetVehRadioStation(k,"OFF")SetVehicleFixed(k)SetVehicleDeformationFixed(k)SetVehicleUndriveable(k,false)SetVehicleEngineOn(k,true,true)SetEntityAsMissionEntity(k,true,false)TaskWarpPedIntoVehicle(GetPlayerPed(-1),k,-1)SetEntityCollision(k,false,true)h=k;FreezeEntityPosition(k,true)end)Citizen.CreateThread(function()while f>0 and d==nil do local l=string.format("VISSZASZÁMLÁLÁS ~n~ %d",f)SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(l)DrawText(0.50,0.2)Wait(0)end end)TriggerEvent("Magic:CanMage",false)end)RegisterNetEvent("MagicGame:RaceWon")AddEventHandler("MagicGame:RaceWon",function(i,m,n)if g==i then SetEntityCoords(GetPlayerPed(-1),d.StartCoords,true,false,false,false)DeleteEntity(h)h=nil;d=nil;c=0;local o=10;g=nil;TriggerEvent("Magic:CanMage",true)Citizen.CreateThread(function()while o>0 do o=o-1;Wait(1000)end end)Citizen.CreateThread(function()while o>0 do local l="A VERSENY GYÖZTESE: ~n~ "..m.."~n~".."NYEREMÉNY: "..n.." Galleon"SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(l)DrawText(0.50,0.2)Wait(0)end end)end end)Citizen.CreateThread(function()for p,q in pairs(b)do q.blip=AddBlipForCoord(q.CP)SetBlipSprite(q.blip,127)SetBlipDisplay(q.blip,4)SetBlipScale(q.blip,0.9)SetBlipColour(q.blip,2)SetBlipAsShortRange(q.blip,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString("VERSENY "..q.name)EndTextCommandSetBlipName(q.blip)end;while true do if e~=nil then Wait(1000)f=f-1 end;if f==0 then FreezeEntityPosition(h,false)d=e;e=nil;f=10;TriggerEvent("Magic:CanMage",false)SetEntityCollision(h,true,true)end;Wait(100)end end)Citizen.CreateThread(function()while true do local r=GetEntityCoords(GetPlayerPed(-1))local s=false;for t,u in pairs(b)do if#(u.CP-r)<10 then DrawMarker(2,u.CP,0.0,0.0,0.0,180.0,0.0,0.0,0.5,0.5,0.5,255,0,0,255,false,true,2,false,false,false,false)s=true;if#(u.CP-r)<1 then if IsControlPressed(1,38)then OpenMenu(t)end end end end;if not s then Wait(2000)end;Wait(0)end end)function OpenMenu(v)ESX.TriggerServerCallback("MagicGame:GetIsActive",function(w)if w then ESX.UI.Menu.Open('default',GetCurrentResourceName(),'gondolat_menu',{title="Verseny",align='top-left',elements={{label='Regisztáció ('..w.beugro..")",value='register'}}},function(l,x)if l.current.value=='register'then TriggerServerEvent("MagicGame:Register",v)x.close()end end,function(l,x)x.close()end)else ESX.UI.Menu.Open('dialog',GetCurrentResourceName(),"szemely_neve",{title="Beugró"},function(y,z)local A=y.value;TriggerServerEvent("MagicGame:RaceActive",v,A,b[v].name)z.close()end,function(y,z)z.close()end)end end,v)end;Citizen.CreateThread(function()while true do if d~=nil then local B=d.Waypoints;local C=B[c+1]local D=GetEntityCoords(GetPlayerPed(-1))if C then if#(D-C)<10.5 and C then c=c+1 end else TriggerServerEvent("MagicGame:RaceWon",g)end;local E=1;for t,u in pairs(B)do if E>=c+1 then if E==c+1 then DrawMarker(6,u,0.0,0.0,0.0,0.0,0.5,0.0,10.5,10.5,10.5,0,255,0,255,false,true,2,false,false,false,false)else DrawMarker(6,u,0.0,0.0,0.0,0.0,0.5,0.0,10.5,10.5,10.5,255,0,0,255,false,true,2,false,false,false,false)end end;local l=string.format("CHECKPOINT %d / %d",c,#B)SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(l)DrawText(0.50,0.2)E=E+1 end end;Wait(0)end end)Citizen.CreateThread(function()while true do if d~=nil or h~=nil then local F=h;for G in EnumerateVehicles()do SetEntityNoCollisionEntity(G,F,false)end end;Wait(500)end end)
