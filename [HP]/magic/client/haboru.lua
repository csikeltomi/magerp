ESX=nil;Citizen.CreateThread(function()while ESX==nil do TriggerEvent("esx:getSharedObject",function(a)ESX=a end)Citizen.Wait(0)end end)local b={}local c={}local d={}local e={}RegisterNetEvent("Haboru:SyncZones")AddEventHandler("Haboru:SyncZones",function(f,g)d=f;c=g end)Citizen.CreateThread(function()while true do local h=3;if c['A']and c['B']then local i=""local j=""local k=math.ceil(c['A']/15)local l=math.ceil(c['B']/15)for m=1,k,1 do i=i.."|"end;for m=1,l,1 do j=j.."|"end;Ticket2DText("~r~Támadók ~s~"..i.." "..c['A'].."",1)Ticket2DText("~b~ Védök ~s~"..j.." "..c['B'].."",2)end;for n,o in pairs(d)do if#(GetEntityCoords(PlayerPedId())-o.center)<200 then if o.text then DrawText3D(o.text,"~h~"..n.."~s~~n~"..tostring(math.abs(o.points)),255,255,255,20.2)else DrawText3D(o.center,"~h~"..n.."~s~~n~"..tostring(math.abs(o.points)),255,255,255,20.2)end end;if o.points>0 then SetBlipColour(e[n],1)Zona2DText("~r~"..n.."~s~: "..tostring(math.abs(o.points)),h)DrawMarker(28,o.center,0.0,0.0,0.0,0.0,0.0,0.0,o.radius,o.radius,o.radius,255,0,0,50,false,true,2,false,false,false,false)elseif o.points<0 then SetBlipColour(e[n],3)Zona2DText("~b~"..n.."~s~: "..tostring(math.abs(o.points)),h)DrawMarker(28,o.center,0.0,0.0,0.0,0.0,0.0,0.0,o.radius,o.radius,o.radius,0,0,255,50,false,true,2,false,false,false,false)else SetBlipColour(e[n],0)Zona2DText("~s~"..n.."~s~: "..tostring(math.abs(o.points)),h)DrawMarker(28,o.center,0.0,0.0,0.0,0.0,0.0,0.0,o.radius,o.radius,o.radius,255,255,255,50,false,true,2,false,false,false,false)end;h=h+1 end;Wait(0)end end)function Zona2DText(o,h)local p=h*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.5)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(o)DrawText(0.95,0.15+p)ClearDrawOrigin()end;function Ticket2DText(o,h)local p=h*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(o)DrawText(0.02,0.70+p)ClearDrawOrigin()end;function SpawnHaboruPlayer(q,r)local s=r;local t=math.random(2,20)local u=vector3(q.coords.x+t,q.coords.y+t,q.coords.z)SetEntityCoords(GetPlayerPed(-1),q.coords,true,false,false,false)SetEntityHeading(GetPlayerPed(-1),q.heading)Citizen.CreateThread(function()while s>0 do s=s-1;Wait(1000)end end)for n,o in pairs(d)do CreateBlip(n,o.blip)end;Citizen.CreateThread(function()while s>0 do FreezeEntityPosition(GetPlayerPed(-1),true)local o=string.format("VISSZASZÁMLÁLÁS ~n~ %d",s)SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(o)DrawText(0.50,0.2)Wait(0)end;TriggerEvent("Magic:CanMage",true)ESX.Game.SpawnVehicle("akuma",u,q.heading,function(v)FreezeEntityPosition(GetPlayerPed(-1),false)SetVehRadioStation(v,"OFF")SetVehicleFixed(v)SetVehicleDeformationFixed(v)SetVehicleUndriveable(v,false)SetVehicleEngineOn(v,true,true)SetEntityAsMissionEntity(v,true,false)TaskWarpPedIntoVehicle(GetPlayerPed(-1),v,-1)sepru=v end)end)end;RegisterNetEvent("Haboru:Start")AddEventHandler("Haboru:Start",function(q)SpawnHaboruPlayer(q,60)end)RegisterNetEvent("Haboru:awaitRespawn")AddEventHandler("Haboru:awaitRespawn",function(q)local w=PlayerPedId()RespawnPed(w,GetEntityCoords(w),GetEntityHeading(w))print(ESX.DumpTable(q))SpawnHaboruPlayer(q,25)end)function CreateBlip(n,x)local y=AddBlipForCoord(d[n].center)SetBlipSprite(y,x)SetBlipDisplay(y,4)SetBlipScale(y,0.9)SetBlipColour(y,46)SetBlipAsShortRange(y,false)BeginTextCommandSetBlipName("STRING")AddTextComponentString(n)EndTextCommandSetBlipName(y)e[n]=y end;function RespawnPed(z,A,B)SetEntityCoordsNoOffset(z,A.x,A.y,A.z,false,false,false,true)NetworkResurrectLocalPlayer(A.x,A.y,A.z,B,true,false)SetPlayerInvincible(z,false)ClearPedBloodDamage(z)TriggerServerEvent("esx:onPlayerSpawn")TriggerEvent("esx:onPlayerSpawn")TriggerEvent("playerSpawned")end;function DeleteBlips()for C,D in pairs(e)do RemoveBlip(D)end end
