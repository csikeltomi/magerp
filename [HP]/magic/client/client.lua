ESX=nil;Citizen.CreateThread(function()while ESX==nil do TriggerEvent("esx:getSharedObject",function(a)ESX=a end)Citizen.Wait(0)end end)selected_vehicle="SEPRU"local b=true;local c={}local d=nil;local e="proj_indep_firework_v2"local f="scr_xmas_firework_burst_fizzle"local g=PlayerId()local h=PlayerPedId()local i,j,k=table.unpack(GetEntityCoords(h,true))local l,m,n=table.unpack(GetEntityForwardVector(h))l=l*10;m=m*10;local o=false;local p=false;local q='FIRE'local r=false;local s=2000;local t=0;local u=500;local v={[1]=nil,[2]=nil,[3]=nil,[4]=nil,[5]=nil,[6]=nil,[7]=nil}local w=1;local x=-1;local y={}local z=nil;local A,B;local C=false;local o=15;local D=60;local E=nil;local F='WEAPON_UNARMED'local G=nil;local H={}local I=nil;local J,K,L,M=0,0,0,0;local N={["imperio"]={text='Kövesd a "PARANCSOLÓ" utasításait\n~r~Az ellenszegülés szabályellenes!\n~g~ (%d másodpercig) '}}local O={['atlathatosag']={ActiveFunction=function(P,Q)DrawLevelsAndColors(P,Q)end,time=0,active=false,hatas='Atlátás (%d másodpercig)'},['varazsmult']={ActiveFunction=function(P,Q)DrawHistory(P,Q)end,time=0,active=false,hatas='Nyomok felfedése (%d másodpercig)'},['solyom']={ActiveFunction=function(P,Q)ChangePed(P,Q,"a_c_chickenhawk")end,time=0,active=false,hatas='Alakváltás - Sárkány (%d másodpercig)'},['coyote']={ActiveFunction=function(P,Q)ChangePed(P,Q,"a_c_coyote")end,time=0,active=false,hatas='Alakváltás - Kojot (%d másodpercig)'},['cica']={ActiveFunction=function(P,Q)ChangePed(P,Q,"a_c_deer")end,time=0,active=false,hatas='Alakváltás - Kitsune (%d másodpercig)'},['hollo']={ActiveFunction=function(P,Q)ChangePed(P,Q,"a_c_crow")end,time=0,active=false,hatas='Alakváltás - Holló (%d másodpercig)'},['lathatatlansag']={ActiveFunction=function(P,Q)Lathatatlansag(P,Q)end,time=0,active=false,hatas='Láthatatlanság (%d másodpercig)'}}function Lathatatlansag(R,S)Citizen.CreateThread(function()local T=GetPlayerPed(-1)SetEntityVisible(T,false,0)while O[R].time>0 do O[R].time=O[R].time-1;Citizen.Wait(1000)end;SetEntityVisible(T,true,0)end)end;function ChangePed(R,S,h)Citizen.CreateThread(function()TriggerEvent("ped:SetModel",h)if G==nil then G=h end;while O[R].time>0 do O[R].time=O[R].time-1;ResetPlayerStamina(GetPlayerIndex())Citizen.Wait(1000)end;if G==h then TriggerEvent("ped:SetModel","RESET")G=nil end end)end;local U=10;local V=nil;local W=nil;local X={["WEAPON_APPISTOL"]=1.5,["WEAPON_PISTOL50"]=1.2,["WEAPON_FLAREGUN"]=1}local Y='nincs'local Z={['kek']={mana=0,manaregen=0.05,healthregen=0,health=0,cd=0,Defendo=false,Resurrection=0,Permoveo=50,Momentum=0},['sarga']={mana=0,manaregen=0,healthregen=0,health=0,cd=0.05,Defendo=false,Resurrection=0,Permoveo=0,Momentum=50},['voros']={mana=0,manaregen=0,healthregen=0,health=30,cd=0,Defendo=false,Resurrection=0,Permoveo=0,Momentum=0},['zold']={mana=0,manaregen=0,healthregen=0.08,health=0,cd=0,Defendo=false,Resurrection=30,Permoveo=0,Momentum=0},['nincs']={mana=0,manaregen=0,healthregen=0,health=0,cd=0,Defendo=false,Resurrection=0,Permoveo=0,Momentum=0}}local _={["ALOHOMORA"]=function(a0)local a1=X[F]return"n/"..math.floor(a0/20/a1,0)end,["INVITO"]=function(a0)local a1=X[F]return math.floor(100*a0/2/a1,0)end,["LUMOS"]=function(a0)local a1=X[F]return math.floor(100*a0/2/a1,0)end,["TELEPORT2"]=function(a0)local a1=X[F]return math.floor(100*a0/a1,0)end,["TELEPORT"]=function(a0)local a1=X[F]return math.floor(100*a0/2/a1,0)end,["WALL"]=function(a0)local a1=X[F]if Y=="voros"then local a2=50*a0/3/a1;return math.floor(a2*2,0)end;return math.floor(50*a0/3/a1,0)end,["BLOW"]=function(a0)local a1=X[F]return math.floor(200*a0/3/a1,0)end,["FIRE"]=function(a0)local a1=X[F]return math.floor(100*a0/3/a1,0)end,["AVADAKEDABRA"]=function(a0)local a1=X[F]return math.floor(500*a0/2/a1,0)end,["BLACKBLOW"]=function(a0)local a1=X[F]return math.floor(500*a0/3/a1,0)end,["BLACKFIRE"]=function(a0)local a1=X[F]return math.floor(200*a0/2/a1,0)end,["IMPERIO"]=function(a0)local a1=X[F]return math.floor(300*a0/2/a1,0)end,["STUN"]=function(a0)local a1=X[F]return math.floor(350*a0/2/a1,0)end,["WATER"]=function(a0)local a1=X[F]return math.floor(10*a0/3/a1,0)end,["REVIVE"]=function(a0)local a1=X[F]return math.floor(100*a0/2/a1,0)end,["PORTAL1"]=function()local a1=X[F]return 2000/a1 end,["PORTAL2"]=function()local a1=X[F]return 2000/a1 end,["PORTAL3"]=function()local a1=X[F]return 2000/a1 end,["PORTAL4"]=function()local a1=X[F]return 2000/a1 end,["PORTAL5"]=function()local a1=X[F]return 2000/a1 end,["PORTAL6"]=function()local a1=X[F]return 2000/a1 end,["BLOWAROUND-SMOKE"]=function(a0)local a1=X[F]return math.floor(10*a0/3/a1,0)end,["BLOWAROUND-FIRE"]=function(a0)local a1=X[F]return math.floor(10*a0/3/a1,0)end,["BLOWAROUND-EXPLOSION"]=function(a0)local a1=X[F]return math.floor(10*a0/3/a1,0)end,["LEVIOSA"]=function(a0)local a1=X[F]return math.floor(10*a0/3/a1,0)end,["CLONE"]=function(a0)local a1=X[F]return math.floor(300*a0/3/a1,0)end,["CUFF"]=function(a0)local a1=X[F]return math.floor(100*a0/3/a1,0)end,["IMMOBILIZE"]=function(a0)local a1=X[F]return math.floor(400*a0/2/a1,0)end,["MOMENTUM"]=function(a0)local a1=X[F]return math.floor(700*a0/2/a1,0)end}Citizen.CreateThread(function()AddTextEntry("WT_PIST_50",'Arany pálca')AddTextEntry("WT_PIST_AP",'Bodza pálca')AddTextEntry("WT_FLAREGUN",'Varázspálca - Fönix toll')end)function isPalca(a3)for a4,a5 in pairs(X)do if GetHashKey(a4)==a3 then return true end end;return false end;function DrawName3D(i,j,k,a6)SetDrawOrigin(i,j,k,0)SetTextFont(0)SetTextProportional(0)SetTextScale(0.0,0.23)SetTextColour(19,232,46,240)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(a6)DrawText(0.0,0.0)ClearDrawOrigin()end;Citizen.CreateThread(function()while true do Citizen.Wait(0)if U==0 and V~=nil then Citizen.Wait(2000)else U=U-1;if U==0 then V=nil;W=nil;I=nil;TriggerServerEvent("Magic:StopIMPERIO",GetPlayerFromServerId(W),0)end;Citizen.Wait(1000)end end end)Citizen.CreateThread(function()while true do ESX.TriggerServerCallback("Magic:GetColorItems",function(a7)c=a7 end)Citizen.Wait(10000)end end)Citizen.CreateThread(function()while true do for a4,a5 in pairs(O)do if not a5.active and a5.time>0 then O[a4].ActiveFunction(a4,a5.time)O[a4].active=true elseif a5.active and a5.time<=0 then O[a4].active=false end end;Citizen.Wait(500)for a4,a5 in pairs(X)do h=GetPlayerPed(-1)if GetSelectedPedWeapon(h)==GetHashKey(a4)then local a8=F;F=a4;if GetSelectedPedWeapon(h)~=GetHashKey(a8)then for a9=1,#v,1 do if v[a9]~=nil then v[a9].mana=_[v[a9].mage](v[a9].level)end end;TriggerEvent('InventoryHud:LoadQB',v)end end end end end)Citizen.CreateThread(function()while true do Citizen.Wait(0)if V==nil or I~=nil then Citizen.Wait(1000)else if W~=nil then local aa=GetPlayerPed(GetPlayerFromServerId(W))i,j,k=table.unpack(GetEntityCoords(aa))DrawName3D(i,j,k+1.0,"PARANCSOLÓ")if#(GetEntityCoords(aa)-GetEntityCoords(h))<15 then DrawMarker(28,GetEntityCoords(h),0.0,0.0,0.0,0.0,0.0,0.0,15.0,15.0,15.0,128,0,128,50,false,true,2,true,false,false,false)else TriggerServerEvent("Magic:StopIMPERIO",W,0)end end;local a7=string.format(N[V].text,U)SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.4)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(0)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.50,0.2)end end end)Citizen.CreateThread(function()while true do Citizen.Wait(0)local found=false;if I~=nil then found=true;local T=GetPlayerPed(GetPlayerFromServerId(I))if#(GetEntityCoords(T)-GetEntityCoords(h))<15 then DrawMarker(28,GetEntityCoords(T),0.0,0.0,0.0,0.0,0.0,0.0,15.0,15.0,15.0,128,0,128,50,false,true,2,true,false,false,false)else end end;local D=0;for a4,a5 in pairs(O)do if a5.active then found=true;local a7=string.format(a5.hatas,a5.time)local ab=D*0.02;SetTextFont(0)SetTextProportional(1)SetTextScale(0.0,0.3)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.01,0.6+ab)ClearDrawOrigin()D=D+1 end end;if not found then Wait(1000)end end end)Citizen.CreateThread(function()while true do Citizen.Wait(0)local a7=string.format("Eleterö regen.: %.2f e/m",1+J)SetTextFont(0)SetTextProportional(0)SetTextScale(0.5,0.25)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.86,0.92)ClearDrawOrigin()local a7=string.format("Varázserö regen.: %.2f e/m",5+K)SetTextFont(0)SetTextProportional(0)SetTextScale(0.0,0.25)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.86,0.94)ClearDrawOrigin()local a7=string.format("Cooldown Reduction: %.2f%%",L)SetTextFont(0)SetTextProportional(0)SetTextScale(0.0,0.25)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.86,0.96)ClearDrawOrigin()local a7=string.format("Max életerö: %.2f HP",M)SetTextFont(0)SetTextProportional(0)SetTextScale(0.0,0.25)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(a7)DrawText(0.86,0.98)ClearDrawOrigin()end end)RegisterNetEvent('esx:playerLoaded')AddEventHandler('esx:playerLoaded',function(ac)SetPedMaxHealth(h,u+M)end)RegisterNetEvent('Magic:AddHealth')AddEventHandler('Magic:AddHealth',function(ad)local ae=GetPlayerPed(-1)local af=math.floor(GetPedMaxHealth(ae)/100*ad,0)if GetEntityHealth(ae)<=GetPedMaxHealth(ae)then local ag=GetEntityHealth(GetPlayerPed(-1))+af;SetEntityHealth(ae,ag)elseif GetEntityHealth(ae)>GetPedMaxHealth(ae)then local ag=GetPedMaxHealth(ae)SetEntityHealth(h,ag)end end)RegisterNetEvent('Magic:ActivateHatas')AddEventHandler('Magic:ActivateHatas',function(R,ah)O[R].time=ah end)RegisterNetEvent('Magic:AddMana')AddEventHandler('Magic:AddMana',function(ad)local af=t/100*ad;if s>t then s=t end;if s<t then s=s+af end end)function FireWait()Citizen.CreateThread(function()Citizen.Wait(1000)o=false end)end;function SpendMana(D)if s-D>=0 then s=s-D/X[F]end end;function CheckMana(D)if s>=D then return true else exports['b1g_notify']:Notify('false','Elégtelen varázserő')return false end end;Citizen.CreateThread(function()while t==0 do Wait(500)end;s=t end)Citizen.CreateThread(function()while true do local ae=GetPlayerPed(-1)while IsPlayerDead(g)do SetPedToRagdoll(h,1000,1000,0,0,0,0)ResetPedRagdollTimer(h)Citizen.Wait(1)end;local ag=GetEntityHealth(GetPlayerPed(-1))+1+math.floor(ESX.Math.Round(J,0))if GetEntityHealth(ae)<=GetPedMaxHealth(ae)then SetEntityHealth(h,ag)elseif ag>GetPedMaxHealth(ae)then local ag=GetPedMaxHealth(ae)SetEntityHealth(h,ag)end;if s>t then s=t end;if s<t then s=s+5+K end;for a4,a5 in pairs(v)do a5.cd=math.floor(a5.cd)if a5.cd>0 then a5.cd=a5.cd-1 end end;Citizen.Wait(1000)end end)Citizen.CreateThread(function()while true do local ae=GetPlayerPed(-1)local ai=GetEntityCoords(ae)for a in EnumerateObjects()do if GetEntityModel(a)==GetHashKey('prop_glass_panel_06')then SetEntityNoCollisionEntity(a,ae,false)if IsPedSittingInAnyVehicle(ae)then local aj=GetVehiclePedIsIn(ae,false)SetEntityNoCollisionEntity(a,aj,false)end end end;SetEntityNoCollisionEntity(wall,ae,false)if IsPedSittingInAnyVehicle(ae)then local aj=GetVehiclePedIsIn(ae,false)SetEntityNoCollisionEntity(wall,aj,false)end;Citizen.Wait(500)end end)function Split(ak,al)result={}for am in(ak..al):gmatch("(.-)"..al)do table.insert(result,am)end;return result end;RegisterNUICallback("SetQuickMagic",function(a7,an)local found=0;local ao=Split(a7.item.name,'_')local ap={slot=a7.slot,mage=ao[3],level=ao[4],type=ao[2],image=a7.item.name,label=a7.item.label,mana=_[ao[3]](ao[4])or 0,usage=0,cd=0}local aq=false;if v[a7.slot]and v[a7.slot].cd>0 then aq=true end;print(aq)if ao[1]=="m"and not aq then for a9=1,#v,1 do if v[a9]~=nil then if v[a9].image==ap.image then ap.cd=v[a9].cd;found=a9 end end end;if found>0 then v[a7.slot]=ap;v[found]=nil;TriggerServerEvent('Magic:SaveQB',v)else v[a7.slot]=ap;TriggerServerEvent('Magic:SaveQB',v)end;TriggerEvent('InventoryHud:LoadQB',v)end;an("ok")end)RegisterNetEvent('Magic:SetQuickMagic')AddEventHandler('Magic:SetQuickMagic',function(ar,as)local ao=Split(ar,'_')local ap={slot=as,mage=ao[3],level=ao[4],type=ao[2],image=ar,label=ar.label,mana=_[ao[3]](ao[4])or 0,usage=0,cd=0}if ap.mage==v[as].mage and tonumber(ap.level)>tonumber(v[as].level)then v[as]=ap;TriggerServerEvent('Magic:SaveQB',v)end;if v[as].cd==0 then v[as]=ap;TriggerServerEvent('Magic:SaveQB',v)end end)RegisterNetEvent('Magic:SetQuickbar')AddEventHandler('Magic:SetQuickbar',function(at)for a9=1,#v,1 do if v[a9]~=nil then for au=1,#at do if at[au]~=nil then if v[a9].image==at[au].image then at[au].cd=v[a9].cd end end end end end;v=at end)Citizen.CreateThread(function()while true do if H then for a4,a5 in pairs(H)do if a5.time>0 then H[a4].time=a5.time-1 else RemoveBlip(a5.blip)H[a4]=nil end end end;Wait(1000)end end)RegisterNetEvent('Magic:AddBlip')AddEventHandler('Magic:AddBlip',function(ai,av,aw)local ax=AddBlipForCoord(ai.x,ai.y,ai.z)SetBlipRotation(ax,0)SetBlipDisplay(ax,2)SetBlipSprite(ax,161)SetBlipColour(ax,av)SetBlipScale(ax,1.0)SetBlipHighDetail(ax,true)SetBlipShrink(ax,true)local ay={blip=ax,time=aw}table.insert(H,ay)end)CreateThread(function()while true do Wait(0)local h=PlayerPedId()SetPedMaxHealth(h,u+M)if IsPedInAnyVehicle(h)then local az=GetVehiclePedIsUsing(h)SetVehicleFuelLevel(az,60.0)for a4,a5 in pairs(X)do if HasPedGotWeapon(h,GetHashKey(a4))then SetCurrentPedWeapon(h,GetHashKey(a4),true)end end;if DoesVehicleHaveRocketBoost(az)then if IsControlJustPressed(0,103)then r=not r end;if r then SetVehicleRocketBoostPercentage(az,100.0)else end end end end end)local aA=false;function ToggleWeapon()Citizen.CreateThread(function()if not aA then aA=true;if F~='WEAPON_FLAREGUN'then ESX.TriggerServerCallback("Magic:HaveWand",function(result)if result then h=GetPlayerPed(-1)RemoveWeaponFromPed(h,GetHashKey('WEAPON_FLAREGUN'))Wait(200)GiveWeaponToPed(h,GetHashKey('WEAPON_FLAREGUN'),0,false,true)F='WEAPON_FLAREGUN'end end)else F='WEAPON_UNARMED'end end;SetCurrentPedWeapon(h,GetHashKey(F),true)Wait(1000)aA=false end)end;RegisterNetEvent("Mage:Attack")AddEventHandler("Mage:Attack",function()local h=PlayerPedId()local found=false;for a4,a5 in pairs(X)do if HasPedGotWeapon(h,GetHashKey(a4))then SetCurrentPedWeapon(h,GetHashKey(a4),true)found=true;break end end;if not found then else p=true end end)Citizen.CreateThread(function()RequestNamedPtfxAsset(e)while not HasNamedPtfxAssetLoaded(e)do Citizen.Wait(0)end;print('\n[PARTICLES] Finished loading particle dictionary ('..e..').')UseParticleFxAssetNextCall(e)while true do Citizen.Wait(0)if not HasPedGotWeapon(h,GetHashKey('WEAPON_BALL'))then end;if IsDisabledControlPressed(0,37)then EnableControlAction(0,37,true)else DisableControlAction(0,157,true)DisableControlAction(0,37,true)DisableControlAction(0,158,true)DisableControlAction(0,160,true)DisableControlAction(0,164,true)DisableControlAction(0,165,true)DisableControlAction(0,159,true)end;if isPalca(GetSelectedPedWeapon(h))then if IsControlJustPressed(0,24)and not p and not HasPedGotWeapon(h,GetHashKey('WEAPON_BALL'))then p=true elseif IsControlJustPressed(0,157)or IsDisabledControlPressed(0,157)then w=1 elseif IsControlJustPressed(0,158)or IsDisabledControlPressed(0,158)then w=2 elseif IsControlJustPressed(0,160)or IsDisabledControlPressed(0,160)then w=3 elseif IsControlJustPressed(0,164)or IsDisabledControlPressed(0,164)then w=4 elseif IsControlJustPressed(0,165)or IsDisabledControlPressed(0,165)then w=5 elseif IsControlJustPressed(0,159)or IsDisabledControlPressed(0,159)then w=6 elseif IsControlJustPressed(0,161)or IsDisabledControlPressed(0,161)then w=7 elseif IsControlJustPressed(0,162)or IsDisabledControlPressed(0,162)then elseif IsControlJustPressed(0,163)or IsDisabledControlPressed(0,163)then end end;if GetSelectedPedWeapon(h)==GetHashKey('WEAPON_PISTOL50')then if p then end end;if IsControlJustReleased(0,24)and p then p=false end end end)RegisterNetEvent('Magic:CSyncParticle')AddEventHandler('Magic:CSyncParticle',function(aB,aC,aD,aE,aF,S)Citizen.CreateThread(function()UseParticleFxAssetNextCall(aB)local aG=StartParticleFxLoopedAtCoord(aC,aD,aE,aF,0.0,0.0,GetEntityHeading(PlayerPedId()),5.0,false,false,false,false)SetParticleFxLoopedFarClipDist(aG,1000.0)Citizen.Wait(S)StopParticleFxLooped(aG,0)end)end)RegisterNetEvent('Magic:MagicLeviosa')AddEventHandler('Magic:MagicLeviosa',function(aH,a0)MagicLeviosa(NetworkGetEntityFromNetworkId(aH),a0)end)RegisterNetEvent('Magic:MagicTeleport2')AddEventHandler('Magic:MagicTeleport2',function(ai,aH,a0)MagicTeleport2(ai,aH,a0)end)RegisterNetEvent('Magic:DespawnSync')AddEventHandler('Magic:DespawnSync',function(az)print("TO DELETE"..az)local aI=nil;for aj in EnumerateVehicles()do local aJ=GetVehicleNumberPlateText(aj)aJ=ESX.Math.Trim(aJ)print(aJ.." = "..az)if aJ==az then while DoesEntityExist(aj)do ESX.Game.DeleteVehicle(aj)Wait(100)end;print("DELETE")aI=aj end end;Citizen.CreateThread(function()if aI~=nil then local aK=0;while aK==10000 do local aL=GetEntityCoords(aI)PlayEffect("core","ent_amb_sparking_wires",aL.x,aL.y,aL.z)PlayEffect("core","ent_amb_cig_smoke_linger",aL.x,aL.y,aL.z)Citizen.Wait(1)end end end)end)function PlayEffect(aB,aC,aD,aE,aF)Citizen.CreateThread(function()UseParticleFxAssetNextCall(aB)local aG=StartParticleFxLoopedAtCoord(aC,aD,aE,aF,0.0,0.0,GetEntityHeading(PlayerPedId()),2.0,false,false,false,false)Citizen.Wait(300)StopParticleFxLooped(aG,0)end)end;RegisterNetEvent('Magic:PlayTEffect')AddEventHandler('Magic:PlayTEffect',function(aB,aC,aD,aE,aF,S)TriggerServerEvent('Magic:SyncParticle',aB,aC,aD,aE,aF,S)end)function PlayTEffect(aB,aC,aD,aE,aF,S)TriggerServerEvent('Magic:SyncParticle',aB,aC,aD,aE,aF,S)end;function PlayTEffect2(aB,aC,aD,aE,aF,S)Citizen.CreateThread(function()UseParticleFxAssetNextCall(aB)local aG=StartParticleFxLoopedAtCoord(aC,aD,aE,aF,0.0,0.0,GetEntityHeading(PlayerPedId()),5.0,false,false,false,false)Citizen.Wait(S)StopParticleFxLooped(aG,0)end)end;function PlayTEffect3(aB,aC,aH,S)Citizen.CreateThread(function()UseParticleFxAssetNextCall(aB)local aG=StartNetworkedParticleFxLoopedOnEntity(aC,aH,0.0,0.0,GetEntityHeading(PlayerPedId()),5.0,false,false,false,false)Citizen.Wait(S)StopParticleFxLooped(aG,0)end)end;local function aM(aN)local aO={x=math.pi/180*aN.x,y=math.pi/180*aN.y,z=math.pi/180*aN.z}local aP={x=-math.sin(aO.z)*math.abs(math.cos(aO.x)),y=math.cos(aO.z)*math.abs(math.cos(aO.x)),z=math.sin(aO.x)}return aP end;local function aQ(aR)local aS=GetGameplayCamRot()local aT=GetGameplayCamCoord()local aP=aM(aS)local aU={x=aT.x+aP.x*aR,y=aT.y+aP.y*aR,z=aT.z+aP.z*aR}local aV,aW,aX,aY,aZ=GetShapeTestResult(StartShapeTestRay(aT.x,aT.y,aT.z,aU.x,aU.y,aU.z,-1,-1,1))return aW,aX,aZ end;RegisterNetEvent('Magic:CSyncParticle2')AddEventHandler('Magic:CSyncParticle2',function(aB,aC,aD,aE,aF,a_,b0,aW,shooter,b1)Citizen.CreateThread(function()if Vdist(b1,GetEntityCoords(GetPlayerPed(-1)))<=300 then local i,j,k=table.unpack(GetPedBoneCoords(GetPlayerPed(GetPlayerFromServerId(shooter)),58866,0.0,0.0,0.0))UseParticleFxAssetNextCall(aB)local b2=aD-i;local b3=aE-j;local b4=aF-k;local b5=50-Vdist(i,j,k,aD,aE,aF)/300;for a9=1,1000,b5 do local b6=vector3(i+0.001*b2*a9+math.random(1,2)/10,j+0.001*b3*a9+math.random(1,2)/10,k+0.001*b4*a9+math.random(1,2)/10)PlayEffect(aB,aC,i+0.001*b2*a9+math.random(1,2)/10,j+0.001*b3*a9+math.random(1,2)/10,k+0.001*b4*a9+math.random(1,2)/10)local aP=vector3(b6.x,b6.y,b6.z-5)-b6;DrawSpotLight(b6.x,b6.y,b6.z,aP.x,aP.y,aP.z,a_,b0,aW,10.0,100.0,0.0,100.0,100.0)Citizen.Wait(1)end;Citizen.Wait(100)for a9=1,10000,1 do end end end)end)RegisterNetEvent('Magic:CSyncTeleport')AddEventHandler('Magic:CSyncTeleport',function(aB,aC,aD,aE,aF,b7)Citizen.CreateThread(function()local i,j,k=table.unpack(b7)UseParticleFxAssetNextCall(aB)local b2=aD-i;local b3=aE-j;local b4=aF-k;for a9=1,1000,1 do PlayEffect(aB,aC,i+0.004*b2*a9+math.random(1,2)/1000,j+0.004*b3*a9+math.random(1,2)/1000,k+0.004*b4*a9+math.random(1,2)/1000)end end)end)RegisterNetEvent('Magic:SetPlayerLevel')AddEventHandler('Magic:SetPlayerLevel',function(a0,b8,b9,ba)A=b8;B=b9/ba;x=a0;local bb=2000+a0*50;t=bb;local bc=500+a0*5;u=bc;SetPedMaxHealth(h,u+M)end)RegisterNetEvent('Magic:MagicLumos')AddEventHandler('Magic:MagicLumos',function(bd)y=bd end)function ShootDirection(aB,aC,aD,aE,aF,a_,b0,aW)TriggerServerEvent('Magic:SyncParticle2',aB,aC,aD,aE,aF,a_,b0,aW)end;Citizen.CreateThread(function()while true do Citizen.Wait(0)for a4,a5 in pairs(y)do local be=GetPlayerPed(GetPlayerFromServerId(a4))if#(GetEntityCoords(be)-GetEntityCoords(GetPlayerPed(-1)))<=300 then local bf=GetEntityHeading(be)local aP=GetEntityForwardVector(be)local bg,bh,bi=table.unpack(GetPedBoneCoords(be,58866,0.0,0.0,0.0))local bj,bk,bl=table.unpack(GetEntityCoords(be,true))DrawSpotLight(bg,bh,bi,aP.x,aP.y,aP.z,0,133,255,a5*5.0,10.0,0.0,45.0,100.0)end end end end)function GetPedInFront()local bm=PlayerId()local bn=GetPlayerPed(bm)local bo=GetEntityCoords(bn,false)local bp=GetOffsetFromEntityInWorldCoords(bn,0.0,1.3,0.0)local bq=StartShapeTestCapsule(bo.x,bo.y,bo.z,bp.x,bp.y,bp.z,1.0,12,bn,7)local br,br,br,br,h=GetShapeTestResult(bq)return h end;RegisterNetEvent('Magic:CanMage')AddEventHandler('Magic:CanMage',function(bs)b=bs end)Citizen.CreateThread(function()while true do if not X[F]then Wait(1000)end;if v[w]and b then if p and v[w].cd==0 then q=v[w].mage;local a0=v[w].level;local bt=v[w].type;TriggerServerEvent("Magic:RegisterNyom",GetEntityCoords(GetPlayerPed(-1)),{level=a0,type=bt,mage=q})TriggerServerEvent('Magic:ActivateSkill',v[w])SetParticleFxShootoutBoat(true)local bu,ai,aH=aQ(500.0)if v[w].cd==0 then if E~=nil then ai=GetEntityCoords(E)aH=E end;local bg,bh,bi=table.unpack(GetPedBoneCoords(GetPlayerPed(GetPlayerFromServerId(h)),58866,0.0,0.0,0.0))local b5=Vdist(bg,bh,bi,ai.x,ai.y,ai.z)local bv=b5;Citizen.CreateThread(function()local bw='magic1'if v[w].type=='10'then bw='magic3'end;if v[w].type~='0'then TriggerServerEvent('InteractSound_SV:PlayWithinDistance',80.0,bw,0.4)end;Citizen.Wait(bv)if q=='FIRE'then MagicFire(ai,a0)elseif q=='BLACKFIRE'then MagicBlackFire(ai,a0)elseif q=='ALOHOMORA'then MagicAlohomora(ai,a0,aH)elseif q=='BLOW'then MagicBlow(ai,a0)elseif q=='BLACKBLOW'then MagicBlackBlow(ai,a0)elseif q=='WATER'then MagicWater(ai,a0)elseif q=='WALL'then MagicWall(ai,a0)elseif q=='AVADAKEDABRA'then MagicAvadakedabra(ai,a0,aH)elseif q=='IMPERIO'then MagicImperio(ai,a0,aH)elseif q=='STUN'then MagicStun(ai,a0,GetPlayerServerId(NetworkGetEntityOwner(aH)))elseif q=='REVIVE'then local ag=GetEntityHealth(GetPlayerPed(-1))local bx=math.floor(ag/(5-a0/3))if Z[Y].Resurrection>0 then SetEntityHealth(PlayerPedId(),math.floor(ag-ag/3,0))else SetEntityHealth(PlayerPedId(),math.floor(bx,0))end;MagicRevive(ai,1,GetPlayerServerId(NetworkGetEntityOwner(aH)))elseif q=='TELEPORT'then MagicTeleport(ai,a0)elseif q=='TELEPORT2'then local by=GetFirstBlipInfoId(8)local bz=GetBlipInfoIdCoord(by)print(bz)local bA,bB=ESX.Game.GetClosestPlayer(GetEntityCoords(h))local bC=isBlacklistedCoords(bz)if bz==vector3(0.0,0.0,0.0)then exports['okokNotify']:Alert("Movent Multa","Nem jelölted ki a helyszínt!",10000,'warning')end;if bC then exports['okokNotify']:Alert("Movent Multa","Ez egy mágiával védett terület!",10000,'warning')end;if bB<2.0 and bz~=vector3(0.0,0.0,0.0)and not bC and bA~=nil then print("BRING WITH ME: "..GetPlayerServerId(bA))TriggerServerEvent('Magic:MagicTeleport2',bz,GetPlayerServerId(bA),a0)end elseif q=='FUTOTUZ'then StartScriptFire(ai,20,true)elseif q=='LUMOS'then TriggerServerEvent('Magic:MagicLumos',10)elseif q=='WALL'then elseif q=='PORTAL1'then MagicPortal(1)elseif q=='PORTAL2'then MagicPortal(2)elseif q=='PORTAL3'then MagicPortal(3)elseif q=='PORTAL4'then MagicPortal(4)elseif q=='PORTAL5'then MagicPortal(5)elseif q=='PORTAL6'then MagicPortal(6)elseif q=='LEVIOSA'then elseif q=='CUFF'then MagicHandcuff(ai,a0,aH)elseif q=='CLONE'then MagicClone(ai,a0,aH)elseif q=='IMMOBILIZE'then MagicImmobilio(ai,a0,aH)elseif q=='MOMENTUM'then MagicMomentum(ai,a0,aH)end end)end;if q=='FIRE'then ShootDirection("core","sp_fbi_fire_drip_trails",ai.x,ai.y,ai.z,255,0,0)elseif q=='BLACKFIRE'then ShootDirection("core","sp_fbi_fire_drip_trails",ai.x,ai.y,ai.z,255,0,0)elseif q=='BLOW'then ShootDirection("core","proj_flare_trail",ai.x,ai.y,ai.z,255,0,0)elseif q=='STUN'then ShootDirection("core","proj_flare_trail",ai.x,ai.y,ai.z,0,0,255)elseif q=='REVIVE'then ShootDirection("proj_indep_firework_v2","scr_firework_indep_burst_rwb",ai.x,ai.y,ai.z,0,255,0)ShootDirection("core","ent_amb_sparking_wires",ai.x,ai.y,ai.z,0,0,255)elseif q=='ALOHOMORA'then ShootDirection("core","proj_flare_trail",ai.x,ai.y,ai.z,255,255,0)elseif q=='AVADAKEDABRA'then ShootDirection("core","bul_grass",ai.x,ai.y,ai.z,255,0,255)elseif q=='BLACK_BLOW'then ShootDirection("core","bul_grass",ai.x,ai.y,ai.z,255,0,255)elseif q=='IMPERIO'then ShootDirection("core","bul_grass",ai.x,ai.y,ai.z,255,0,255)elseif q=='FUTOTUZ'then ShootDirection("core","proj_flare_trail",ai.x,ai.y,ai.z,255,0,0)elseif q=='BLOWAROUND-FIRE'then MagicBlowAroundFire(ai,a0)elseif q=='BLOWAROUND-SMOKE'then MagicBlowAroundSmoke(ai,a0)elseif q=='BLOWAROUND-EXPLOSION'then MagicBlowAroundExplosion(ai,a0)elseif q=='BLOWAROUND-WATER'then MagicBlowAroundWater(ai,a0)elseif q=='WATER'then Citizen.Wait(250)ShootDirection("core","ent_amb_sparking_wires",ai.x,ai.y,ai.z,0,0,255)elseif q=='WALL'then elseif q=='INVITO'then MagicInvito(ai,2000,a0)end;p=false else Citizen.Wait(0)end else Citizen.Wait(0)end end end)function isBlacklistedCoords(bz)for a4,bD in pairs(FixBlips)do local bE=vector3(bD.x,bD.y,1.0)if Vdist(bE,bz)<30 then return true end end;return false end;function MagicBlowAroundFire(ai,a0)local a2=200-a0*2;local h=GetPlayerPed(-1)if CheckMana(a2)then SpendMana(a2)SetCD(150-a0*2)local i,j,k=table.unpack(GetEntityCoords(h,true))local a_=20;local bj,bk,bl=table.unpack(GetPedBoneCoords(h))local bF=true;PlayEffect("core","proj_flare_trail",bj,bk,bl)Citizen.CreateThread(function()while bF do Citizen.Wait(0)local bj,bk,bl=table.unpack(GetEntityCoords(h,true))local aP=vector3(bj,bk,bl-1)-GetEntityCoords(h,true)DrawSpotLight(bj,bk,bl,aP.x,aP.y,aP.z,255,0,0,5.0,100.0,30.0,100.0,10.0)end end)Citizen.CreateThread(function()for a9=1,360,5 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)PlayTEffect("core","ent_ray_meth_fires",bH,bI,k-1,20000)Citizen.Wait(10)end end)Citizen.CreateThread(function()for a9=1,360 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k,30,10.0,true,false,0.0)Citizen.Wait(10)end;bF=false end)Citizen.CreateThread(function()for a9=360,1,-1 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k,30,10.0,true,false,0.0)Citizen.Wait(10)end;bF=false end)end end;function MagicBlowAroundSmoke(ai,a0)local a2=200-a0*2;local h=GetPlayerPed(-1)if CheckMana(a2)then SpendMana(a2)SetCD(150-a0*2)local i,j,k=table.unpack(GetEntityCoords(h,true))local a_=15;Citizen.CreateThread(function()for a9=1,360,20 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)TriggerServerEvent('Magic:SyncParticle',"core","exp_grd_bzgas_smoke",bH,bI,k-1,20000)Citizen.Wait(10)end end)Citizen.CreateThread(function()for a9=1,360 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k-1,22,10.0,true,false,0.0)Citizen.Wait(10)end end)Citizen.CreateThread(function()for a9=360,1,-1 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k-1,22,10.0,true,false,0.0)Citizen.Wait(10)end end)end end;function MagicBlowAroundExplosion(ai,a0)local a2=200-a0*2;local h=GetPlayerPed(-1)if CheckMana(a2)then SpendMana(a2)SetCD(150-a0*2)local i,j,k=table.unpack(GetEntityCoords(h,true))local a_=15;for bJ=1,4,1 do Citizen.CreateThread(function()for a9=1,360 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k,4,10.0,true,false,0.0)Citizen.Wait(1)end end)Citizen.CreateThread(function()for a9=360,1,-1 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k,4,10.0,true,false,0.0)Citizen.Wait(1)end end)Citizen.Wait(1000)end end end;function MagicBlowAroundWater(ai,a0)local a2=200-a0*2;local h=GetPlayerPed(-1)if CheckMana(a2)then SpendMana(a2)SetCD(150-a0*2)local i,j,k=table.unpack(GetEntityCoords(h,true))local a_=15;Citizen.CreateThread(function()for a9=1,360,5 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)Citizen.Wait(10)end end)for bJ=1,20,1 do Citizen.CreateThread(function()for a9=1,360,3 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k-1,13,10.0,true,false,0.0)Citizen.Wait(40)end end)Citizen.CreateThread(function()for a9=360,1,-3 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)AddExplosion(bH,bI,k-1,13,10.0,true,false,0.0)Citizen.Wait(40)end end)Citizen.Wait(1000)end end end;function drawTxt(i,j,bK,a6,a_,b0,aW,aV)SetTextFont(0)SetTextProportional(0)SetTextScale(bK,bK)SetTextColour(a_,b0,aW,aV)SetTextDropShadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)SetTextJustification(0)AddTextComponentString(a6)ResetScriptGfxAlign()DrawText(i,j)end;RegisterNetEvent('Magic:AVADAKEDABRA')AddEventHandler('Magic:AVADAKEDABRA',function()SetEntityHealth(PlayerPedId(),0)end)RegisterNetEvent('Magic:IMPERIO')AddEventHandler('Magic:IMPERIO',function(bL,bM,a0)if bL or bM then U=a0*30-math.random(0,10)V="imperio"else U=0;V=nil end;W=bL;I=bM end)RegisterNetEvent('Magic:STUN')AddEventHandler('Magic:STUN',function(a0)C=true;Citizen.CreateThread(function()o=3*a0*100;DoScreenFadeOut(100)while not IsScreenFadedOut()do Citizen.Wait(0)end;while C do Citizen.Wait(1)local bN=GetPlayerPed(-1)if C==true then SetPlayerInvincible(PlayerId(),true)DisablePlayerFiring(PlayerId(),true)SetPedToRagdoll(bN,1000,1000,0,0,0,0)ResetPedRagdollTimer(bN)if o>=0 then o=o-1 else SetPlayerInvincible(PlayerId(),false)DisablePlayerFiring(PlayerId(),false)C=false;DoScreenFadeIn(250)end end end end)end)function SetCD(S)v[w].cd=S-S/100*L end;function MagicPortal(bt)local a2=2000;if CheckMana(a2)then SetCD(999)local ai=GetEntityCoords(PlayerPedId())local br,k=GetGroundZFor_3dCoord(ai.x,ai.y,ai.z,0)TriggerServerEvent('Magic:CreatePortal',vector3(ai.x,ai.y,k+1.0),bt)TriggerServerEvent("vSync:SetWeather",'THUNDER')SpendMana(a2)end end;function MagicLeviosa(aH,a0)Citizen.CreateThread(function()FreezeEntityPosition(aH,true)local bO,bP,bQ=table.unpack(GetEntityCoords(aH))local bR=vector3(bO,bP,bQ)for a9=bQ,bQ+5,0.01 do SetEntityCoords(aH,bO,bP,a9,0,0,0,false)Citizen.Wait(10)end;local bS=bQ+5;for a9=1,5,1 do local bT=math.random()for a9=bS,bS+bT,0.01 do SetEntityCoords(aH,bO,bP,a9,0,0,0,false)Citizen.Wait(50)end;for a9=bS+bT,bS,-0.01 do SetEntityCoords(aH,bO,bP,a9,0,0,0,false)Citizen.Wait(50)end end;FreezeEntityPosition(aH,false)for a9=bQ+5,bR.z,-0.01 do SetEntityCoords(aH,bR.x,bR.y,a9,0,0,0,false)Citizen.Wait(10)end end)end;function MagicTeleport(ai,a0)local bU=20*a0;local bV=GetEntityCoords(h,true)local bW=11-a0;local a2=_['TELEPORT'](a0)-_['TELEPORT'](a0)/100*Z[Y].Permoveo;local bX=25-a0*2;if CheckMana(a2)then if ai.z>=0 and Vdist(ai,bV)<=bU then SpendMana(a2)SetCD(bX-bX/100*Z[Y].Permoveo)TriggerServerEvent('Magic:SyncTeleport',"core","ent_ray_meth_fires",ai.x,ai.y,ai.z,GetEntityCoords(h,true))SetEntityVisible(h,false,false)SetPlayerInvincible(PlayerId(),true)Citizen.Wait(500)local i,j,k=table.unpack(GetEntityCoords(h,true))local b2=ai.x-i;local b3=ai.y-j;local b4=ai.z-k;SetEntityVisible(h,false,false)for a9=1,100,1 do SetEntityCoords(h,i+b2*a9/100,j+b3*a9/100,k+b4*a9/100)Citizen.Wait(bW)end;SetEntityVisible(h,true,true)SetPlayerInvincible(PlayerId(),false)end end end;function GetCoordZHeroin(i,j)for bY=1,1000 do local bZ,b_=GetGroundZFor_3dCoord(i,j,bY+0.0)if bZ then return b_ end;Citizen.Wait(5)end;return 500.0 end;function MagicTeleport2(ai,aH,a0)local bV=GetEntityCoords(h,true)local bW=11-a0;local a2=100*a0;if GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1)))==aH then if CheckMana(a2)then SetCD(200-a0*10)SpendMana(a2)if ai.z>=0 then TriggerServerEvent('Magic:SyncTeleport',"core","ent_ray_meth_fires",ai.x,ai.y,ai.z,GetEntityCoords(h,true))SetEntityVisible(h,false,false)SetPlayerInvincible(PlayerId(),true)DoScreenFadeOut(800)while not IsScreenFadedOut()do Citizen.Wait(50)end;local i,j,k=table.unpack(GetEntityCoords(h,true))local b2=ai.x-i;local b3=ai.y-j;local b4=ai.z-k;SetEntityVisible(h,false,false)for a9=1,100,1 do SetEntityCoords(h,i+b2*a9/100,j+b3*a9/100,k+b4*a9/100)Citizen.Wait(bW)end;for bY=1,1000 do SetPedCoordsKeepVehicle(PlayerPedId(),ai.x,ai.y,bY+0.0)local bZ,b_=GetGroundZFor_3dCoord(ai.x,ai.y,bY+0.0)if bZ then SetPedCoordsKeepVehicle(PlayerPedId(),ai.x,ai.y,bY+0.0)break end;Citizen.Wait(5)end;SetEntityVisible(h,true,true)DoScreenFadeIn(800)SetPlayerInvincible(PlayerId(),false)end else return end end end;function MagicFire(ai,a0)local a2=100*a0/3;if CheckMana(a2)then SpendMana(a2)SetCD(6-a0/2)AddExplosion(ai,3,a0*1.0,false,false,1.0)end end;function MagicBlackFire(ai,a0)local a2=200*a0/3;if CheckMana(a2)then SpendMana(a2)SetCD(12-a0/2)local c0=GetPedBoneCoords(GetPlayerPed(GetPlayerFromServerId(shooter)),58866,0.0,0.0,0.0)if Vdist(GetEntityCoords(GetPlayerPed(-1)),GetEntityCoords(GetPlayerPed(-1)))<=300 then local i,j,k=table.unpack(c0)local aD,aE,aF=table.unpack(ai)local b2=aD-i;local b3=aE-j;local b4=aF-k;local b5=50-Vdist(i,j,k,aD,aE,aF)/300;for a9=1,1000,20 do local b6=vector3(i+0.001*b2*a9+math.random(0,10)/10,j+0.001*b3*a9+math.random(0,10)/10,k+0.001*b4*a9+math.random(0,10)/10)local c1,c2=GetGroundZFor_3dCoord(b6.x,b6.y,900.0,false)if Vdist(GetEntityCoords(GetPlayerPed(-1)),b6)>5 then AddExplosion(b6,3,a0*1.0,false,false,1.0)Citizen.Wait(10)end end;Citizen.Wait(100)end end end;function MagicWall(ai,a0)local a2=_["WALL"](a0)if CheckMana(a2)then SpendMana(a2)local i,j,k=table.unpack(ai)local ae=GetPlayerPed(-1)local c3=GetEntityCoords(ae)+GetEntityForwardVector(ae)*4;local c4='prop_glass_panel_06'local c5=true;if Y=="voros"then SetCD(14)TriggerServerEvent("Magic:OpDefendo",GetEntityCoords(ae,true),GetEntityHeading(ae))else SetCD(3)ESX.Game.SpawnObject(c4,vector3(c3.x,c3.y,k-1.0),function(a)SetEntityHeading(a,GetEntityHeading(ae))FreezeEntityPosition(a,true)SetEntityCollision(a,true,true)Wait(4000)DeleteObject(a)end)end end end;RegisterNetEvent("Magic:SyncImmobilio")AddEventHandler("Magic:SyncImmobilio",function()local az=GetVehiclePedIsIn(PlayerPedId(),false)SetVehicleEngineHealth(az,300)SetVehicleFuelLevel(az,0)local c6=20;Citizen.CreateThread(function()while c6>0 do c6=c6-1;Wait(1000)end end)Citizen.CreateThread(function()while c6>0 do SetVehicleEngineOn(az,false,true,true)Wait(0)end end)end)RegisterNetEvent("Magic:OpDefendo")AddEventHandler("Magic:OpDefendo",function(ai,bf)local i,j,k=table.unpack(ai)local a_=10;local c4='sr_prop_special_bblock_sml1'Citizen.CreateThread(function()for a9=bf+70,bf+100,10 do local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)print("SPAWN")Citizen.CreateThread(function()local a=CreateObject(GetHashKey(c4),vector3(bH,bI,k-2.0),false,false,false)while not DoesEntityExist(a)do Wait(10)end;SetEntityRotation(a,90.0,90.0,a9+0.0,2,true)FreezeEntityPosition(a,true)SetEntityCollision(a,true,true)Wait(15000)DeleteObject(a)end)end end)end)function MagicImmobilio(ai,a0,aH)local a2=_["IMMOBILIZE"](a0)if CheckMana(a2)then SpendMana(a2)SetCD(20-a0)if IsEntityAVehicle(aH)then local h=GetPedInVehicleSeat(aH,-1)TriggerServerEvent("Magic:SyncImmobilio",GetPlayerServerId(NetworkGetEntityOwner(h)))end end end;function MagicWater(ai,a0)local a2=10*a0/3;if CheckMana(a2)then SpendMana(a2)ai=vector3(ai.x,ai.y,ai.z-1)SetCD(6-a0/2)for a9=1,5,1 do ai=vector3(ai.x+a9*0.05,ai.y+a9*0.05,ai.z)AddExplosion(ai,13,100.0,false,false,0.0)end end end;function MagicBlow(ai,a0)local a2=200*a0/3;if CheckMana(a2)then SetCD(8-a0/2)SpendMana(a2)for a9=1,math.ceil(a0/2),1 do AddExplosion(ai,25,100.0,true,false,1.0)Wait(math.random(50,500))end end end;function MagicBlackBlow(ai,a0)local a2=500*a0/3;if CheckMana(a2)then SetCD(8-a0/2)SpendMana(a2)local c0=GetPedBoneCoords(GetPlayerPed(GetPlayerFromServerId(shooter)),58866,0.0,0.0,0.0)if Vdist(GetEntityCoords(GetPlayerPed(-1)),GetEntityCoords(GetPlayerPed(-1)))<=300 then local i,j,k=table.unpack(c0)local aD,aE,aF=table.unpack(ai)local b2=aD-i;local b3=aE-j;local b4=aF-k;local b5=50-Vdist(i,j,k,aD,aE,aF)/300;for a9=1,1000,40 do local b6=vector3(i+0.001*b2*a9+math.random(0,10)/10,j+0.001*b3*a9+math.random(0,10)/10,k+0.001*b4*a9+math.random(0,10)/10)if Vdist(GetEntityCoords(GetPlayerPed(-1)),b6)>5 then AddExplosion(b6,25,a0*100.0,true,false,1.0)Citizen.Wait(20)end end;Citizen.Wait(100)end;AddExplosion(ai,25,a0*100.0,true,false,1.0)end end;function MagicInvito(ai,c7,a0)local a2=100*a0/2;if CheckMana(a2)then SetCD(300-a0*10)local c8=GetEntityForwardVector(h)local aP=c8+GetEntityCoords(h,true)PlayTEffect("core","ent_amb_sparking_wires",aP.x,aP.y,aP.z,10000)PlayTEffect("core","ent_amb_cig_smoke_linger",aP.x,aP.y,aP.z,10000)if z~=nil then local c9=GetEntityCoords(z,true)PlayTEffect3("core","ent_amb_sparking_wires",z,10000)end;TriggerServerEvent('Magic:DespawnSync',tostring(GetPlayerServerId(PlayerId())))Citizen.Wait(10000)SpendMana(a2)if selected_vehicle=="SEPRU"then ESX.Game.SpawnVehicle('AKUMA',aP,GetEntityHeading(h)+90,function(az)if z~=nil then end;SetVehicleNumberPlateText(az,tostring(GetPlayerServerId(PlayerId())))z=az end)else SpawnVehicle2(selected_vehicle.vehicle,selected_vehicle.plate,aP,GetEntityHeading(h)+90,function(aj)z=aj end)end end end;function IsDoor(aH)for a4,a5 in ipairs(Config.DoorList)do local bt=GetEntityModel(aH)if a5.doors then for ca,cb in ipairs(a5.doors)do if cb.objHash==bt then found=true end end else if a5.objHash==bt then found=true end end end;if found then return true else return false end end;function MagicAlohomora(ai,a0,aH)local found=false;local cc=a0*500;if IsDoor then local S=ESX.Math.Round(GetEntityHealth(aH)-a0/10,0)local a2=S/20;if CheckMana(a2)then local aP=GetEntityCoords(aH)SetCD(S)SpendMana(a2)PlayTEffect("core","ent_amb_sparking_wires",aP.x,aP.y,aP.z,S)PlayTEffect("core","ent_amb_cig_smoke_linger",aP.x,aP.y,aP.z,S)Citizen.Wait(S)SetEntityHealth(aH,0)end end end;function MagicAvadakedabra(ai,a0,aH)local a2=500*a0/2;if CheckMana(a2)then SpendMana(a2)end;if CheckMana(a2)and not IsDoor(aH)then SetCD(25-a0*2)SetEntityHealth(aH,1)local cd=Citizen.InvokeNative(0x12534C348C6CB68B,aH)local ce=IsEntityAVehicle(aH)if cd then print("ISPLAYER: "..tonumber(cd))if GetPlayerServerId(NetworkGetEntityOwner(aH))~=nil and tonumber(cd)==1 then print("ASD")aH=GetPlayerServerId(NetworkGetEntityOwner(aH))else end;local bm=ESX.Game.GetPlayersInArea(ai,1.5)if aH and aH~=GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1)))and tonumber(cd)==1 then TriggerServerEvent("Magic:AVADAKEDABRA",aH)end end;if ce then local h=GetPedInVehicleSeat(aH,-1)local cf=GetPlayerServerId(NetworkGetEntityOwner(h))print(cf)TriggerServerEvent("Magic:AVADAKEDABRA",tonumber(cf))end end end;function MagicImperio(ai,a0,aH)local a2=300*a0/2;if CheckMana(a2)and not IsDoor(aH)then SetCD(a0*60)SpendMana(a2)ExplodePedHead(aH,GetHashKey('WEAPON_GRENADE'))if GetPlayerServerId(NetworkGetEntityOwner(aH))~=nil then aH=GetPlayerServerId(NetworkGetEntityOwner(aH))else end;local bm=ESX.Game.GetPlayersInArea(ai,1.5)if aH and aH~=GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1)))then TriggerServerEvent("Magic:IMPERIO",aH,a0)end end end;function MagicStun(ai,a0,aH)local a2=350*a0/2;if CheckMana(a2)then SetCD(7-a0/2)SpendMana(a2)SetPedToRagdoll(aH,1000,1000,0,0,0,0)local ce=IsEntityAVehicle(aH)if ce then local h=GetPedInVehicleSeat(aH,-1)local cf=GetPlayerServerId(NetworkGetEntityOwner(h))TriggerServerEvent("Magic:STUN",cf,a0)else if aH and aH~=GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1)))then TriggerServerEvent("Magic:STUN",aH,a0)end end end end;RegisterNetEvent("Magic:SyncMomentum")AddEventHandler("Magic:SyncMomentum",function(cg,ai,a0)local ch=ai;local ci={}local cj=20.0+a0*2;local S=10.0+a0*2;for h in EnumerateObjects()do if Vdist(GetEntityCoords(h),ch)<cj then table.insert(ci,h)end end;for h in EnumeratePeds()do if Vdist(GetEntityCoords(h),ch)<cj and h~=GetPlayerPed(GetPlayerFromServerId(cg))then table.insert(ci,h)end end;for h in EnumerateVehicles()do if Vdist(GetEntityCoords(h),ch)<cj and not IsPedAPlayer(h)then table.insert(ci,h)end end;Citizen.CreateThread(function()while S>0 do S=S-1;Wait(1000)end end)Citizen.CreateThread(function()while S>0 do for br,aH in pairs(ci)do local aP=vector3(ch.x,ch.y,ch.z-4)-ch;DrawMarker(28,ch,0.0,0.0,0.0,0.0,0.0,0.0,cj,cj,cj,128,0,128,50,false,true,2,true,false,false,false)end;Wait(0)end end)if Vdist(GetEntityCoords(GetPlayerPed(-1)),ai)<cj then TriggerEvent('vSync:updateWeather',-1,"SNOW",false)SetTimecycleModifier("NEW_abattoir")SetTimecycleModifierStrength(0.5)Citizen.CreateThread(function()if GetPlayerPed(-1)~=GetPlayerPed(GetPlayerFromServerId(cg))then TaskPlayAnim(GetPlayerPed(-1),"anim@mp_fm_event@intro","beast_transform",8.0,8.0,S,0,0.4,false,false,false)end;if h~=GetPlayerPed(GetPlayerFromServerId(cg))then b=false end;while S>0 do for br,aH in pairs(ci)do if not IsEntityAVehicle(aH)and NetworkGetEntityOwner(aH)~=cg then FreezeEntityPosition(aH,true)end end;Wait(0)end;b=true;for br,aH in pairs(ci)do FreezeEntityPosition(aH,false)end end)SetTimecycleModifierStrength(0.0)TriggerServerEvent("vSync:requestSync")end end)function MagicMomentum(ai,a0,aH)local a2=_['MOMENTUM'](a0)-_['MOMENTUM'](a0)/100*Z[Y].Momentum;local bX=300-a0*5;if CheckMana(a2)then SetCD(bX-bX/100*Z[Y].Momentum)SpendMana(a2)local ch=GetEntityCoords(GetPlayerPed(-1))TriggerServerEvent("Magic:SyncMomentum",ch,a0)end end;function MagicClone(ai,a0,aH)local a2=_["CLONE"](a0)if CheckMana(a2)then local ck={}SetCD(25-a0)local cl=aH;local S=a0*2;SpendMana(a2)for a9=1,a0,1 do local cm=ClonePed(GetPlayerPed(-1),true,true,true)local i,j,k=table.unpack(GetEntityCoords(GetPlayerPed(-1)))local a_=5;local a9=math.random(1,350)local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)local cn=vector3(bH,bI,k)SetEntityCoords(cm,cn,0,0,0,false)SetEntityNoCollisionEntity(cm,PlayerPedId(),false)local c4=GetHashKey("firedemon")RequestModel(c4)while not HasModelLoaded(c4)do Citizen.Wait(1)end;table.insert(ck,cm)end;for a4,co in pairs(ck)do local i,j,k=table.unpack(GetEntityCoords(GetPlayerPed(-1)))local a_=100;local a9=math.random(1,350)local bG=a9*math.pi/180;local bH,bI=i+a_*math.cos(bG),j+a_*math.sin(bG)local cn=vector3(bH,bI,k)TaskGoToCoordAnyMeans(co,cn,2.0,0,0,786603,1.0)SetEntityOnlyDamagedByPlayer(h,false)for ca,cp in pairs(ck)do SetEntityNoCollisionEntity(h,cp,false)end end;Citizen.CreateThread(function()while S>0 do S=S-1;Wait(1000)end;for a4,h in pairs(ck)do DeleteEntity(h)end end)Citizen.CreateThread(function()while S>0 do for a4,h in pairs(ck)do end;Wait(0)end end)end end;function MagicHandcuff(ai,a0,aH)local a2=_["CUFF"](a0)if CheckMana(a2)then SetCD(20-a0)SpendMana(a2)if IsPedAPlayer(aH)then TriggerServerEvent('cuffServer',GetPlayerServerId(NetworkGetEntityOwner(aH)))end end end;function MagicRevive(ai,a0,aH)local a2=100*a0/2;if CheckMana(a2)then SetCD(6-a0/2)SpendMana(a2)SetPedToRagdoll(aH,1000,1000,0,0,0,0)if aH and aH~=GetPlayerServerId(NetworkGetEntityOwner(GetPlayerPed(-1)))then TriggerServerEvent('esx_ambulancejob:revive',aH)s=0 end end end;function GetCssforColor()local cq=''local cr=-25+75*75/B;if A=='red'then cq='rgba(255, 0, 0, 0.41) 0px 0px 25px '..cr..'px inset'elseif A=='blue'then cq='rgba(0, 0, 255, 0.41) 0px 0px 25px '..cr..'px inset'elseif A=='green'then cq='rgba(0, 255, 0, 0.41) 0px 0px 25px '..cr..'px inset'elseif A=='black'then cq='rgba(0, 0, 0, 1.0) 0px 0px 25px '..cr..'px inset'elseif A=='white'then cq='rgba(255, 255, 255, 0.41) 0px 0px 25px '..cr..'px inset'end;return cq end;Citizen.CreateThread(function()TriggerServerEvent('Magic:GetPlayerLevel')while x==-1 do TriggerServerEvent('Magic:GetPlayerLevel')Citizen.Wait(10)end;TriggerServerEvent('Magic:SetQuickbar')while true do TriggerServerEvent('Magic:GetPlayerLevel')TriggerServerEvent('Magic:UpdateQuickbar')Citizen.Wait(500)local cs;local ct=0;local cu=GetCssforColor()SendNUIMessage({action='setLevel',value=x,css=cu})cs={action='setStatus',status={}}if v then SendNUIMessage({action='setQuickbar',value=v})end;if v[w]then SendNUIMessage({action='setActive',value=w})end;ct=ct+1;local cv=ESX.Math.Round(s/t*100,0)local cw=ESX.Math.Round(GetEntityHealth(GetPlayerPed(-1))/GetPedMaxHealth(GetPlayerPed(-1))*100,0)cs['isdead']=false;cs['status'][ct]={name='mana',value=cv,max=t,current=s}ct=ct+1;cs['status'][ct]={name='health',value=cw,max=GetPedMaxHealth(GetPlayerPed(-1)),current=GetEntityHealth(GetPlayerPed(-1))}if IsEntityDead(GetPlayerPed(-1))then cs.isdead=true end;if ct>0 then SendNUIMessage(cs)end end end)Citizen.CreateThread(function()local cx=nil;while true do Citizen.Wait(0)if v[w]and IsPlayerFreeAiming(g)then if v[w].cd==0 then drawTxt(0.5,0.493,0.15,'O',0,255,0,155)else drawTxt(0.5,0.493,0.15,'O',255,0,0,155)end end;local bu,ai,aH=aQ(200.0)local cy=ESX.Game.GetPlayersInArea(ai,1.0)if IsPedInAnyVehicle(h)or not IsPedInAnyVehicle(h)and IsPedInAnyVehicle(GetPlayerPed(cy[1]))then local az=GetVehiclePedIsIn(h)if bu and NetworkGetEntityIsNetworked(aH)and az~=aH then cx=aH;Citizen.CreateThread(function()Citizen.Wait(500)cx=nil end)end;E=cx;if cx~=nil then local b6=GetEntityCoords(cx)local aP=vector3(b6.x,b6.y,b6.z-4)-b6;DrawSpotLight(b6.x,b6.y,b6.z,aP.x,aP.y,aP.z,255,0,0,10.0,100.0,0.0,100.0,100.0)end else E=nil end;E=cx end end)local cz=5;local cA={}function DrawLevelsAndColors(R,S)local c6=S;Citizen.CreateThread(function()while c6>0 do c6=c6-1;O[R].time=c6;Citizen.Wait(1000)end end)Citizen.CreateThread(function()Wait(500)while c6>0 do for br,cf in ipairs(GetActivePlayers())do local cB=GetPlayerPed(cf)if true then if cA[cf]then if cA[cf]<cz and HasEntityClearLosToEntity(PlayerPedId(),cB,17)then local cC=GetPlayerServerId(cf)local cD=""cD=cD..c[cC][1].level..'\n'for a4,a5 in pairs(c[cC][1].colors)do if a4=="kek_kristaly"then cD=cD.."~b~Kék~s~".."\n"elseif a4=="voros_kristaly"then cD=cD.."~r~Vörös~s~".."\n"elseif a4=="sarga_kristaly"then cD=cD.."~y~Sárga~s~".."\n"end end;local cE=GetEntityCoords(cB)DrawText3D(cE,cD,255,255,255,1.2)end end end end;Citizen.Wait(0)end end)end;Citizen.CreateThread(function()while true do if IsControlPressed(0,19)then for br,cf in ipairs(GetActivePlayers())do local cB=GetPlayerPed(cf)if true then if cA[cf]then if cA[cf]<cz and PlayerPedId()~=cB and HasEntityClearLosToEntity(PlayerPedId(),cB,17)then local cE=GetEntityCoords(cB)DrawText3D(cE,GetPlayerServerId(cf),255,255,255,1.8)end end end end end;Wait(0)end end)function DrawHistory(R,S)local c6=S;local cF={}Citizen.CreateThread(function()while c6>0 do c6=c6-1;O[R].time=c6;ESX.TriggerServerCallback("Magic:GetNyomok",function(cG)cF=cG end)Citizen.Wait(1000)end end)Citizen.CreateThread(function()Wait(500)SetTimecycleModifier("ship_explosion_underwater")SetTimecycleModifierStrength(1.0)while c6>0 do for a4,a5 in pairs(cF)do if#(GetEntityCoords(GetPlayerPed(-1))-a5.coords)<100 then DrawMarker(28,a5.coords,0.0,0.0,0.0,0.0,0.0,0.0,CalculateLevelScale(a5.level),CalculateLevelScale(a5.level),CalculateLevelScale(a5.level),a5.szin.r,a5.szin.g,a5.szin.b,a5.time,false,true,2,true,false,false,false)end end;Citizen.Wait(0)end;SetTimecycleModifierStrength(0.0)end)cF=nil end;function CalculateLevelScale(a0)local D=a0/30;if D>0.2 then return 0.2 end;if D<0.1 then return 0.1 end;return D end;function DrawText3D(b6,a6,a_,b0,aW,cH)local cI,cJ,cK=World3dToScreen2d(b6.x,b6.y,b6.z+1.2)local cL=#(GetGameplayCamCoords()-b6)local bK=1/cL*cH;local cM=1/GetGameplayCamFov()*100;local bK=bK*cM;if cI then if not useCustomScale then SetTextScale(0.0*bK,0.55*bK)else SetTextScale(0.0*bK,customScale)end;SetTextFont(0)SetTextProportional(1)SetTextColour(a_,b0,aW,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)local bY=GetTextScaleHeight(0.0*bK,0.55*bK)local cN=EndTextCommandGetWidth(4)DrawRect(cJ,cK,cN,bY,255,255,255,200)AddTextComponentString(a6)DrawText(cJ,cK)end end;Citizen.CreateThread(function()while true do local cO=PlayerPedId()local cP=GetEntityCoords(cO)for br,cf in ipairs(GetActivePlayers())do local cB=GetPlayerPed(cf)if true then local aR=#(cP-GetEntityCoords(cB))cA[cf]=aR end end;Wait(1000)end end)local cQ=0;local cR=0;local cS=0;local cT=0;local cU={['kek_kristaly']={Active=function(D)cQ=cQ+5*D end},['zold_kristaly']={Active=function(D)cR=cR+2*D end},['sarga_kristaly']={Active=function(D)cT=cT+5*D end},['voros_kristaly']={Active=function(D)cS=cS+100*D end}}local d=nil;Citizen.CreateThread(function()while true do d=ESX.GetPlayerData()Citizen.Wait(5000)cQ=0;cR=0;cS=0;cT=0;for a4,a5 in pairs(cU)do local ar=GetInventoryItem(a4)if ar.count>0 then a5.Active(ar.count)end end;if Y=='kek'then cQ=cQ+cQ*0.1 elseif Y=='zold'then cR=cR+cR*0.1 elseif Y=='piros'then cS=cS+cS*0.1 elseif Y=='sarga'then cT=cT+cT*0.1 end;J=cR+x/50+Z[Y].healthregen*x;K=cQ+x/50+Z[Y].manaregen*x;M=math.floor(cS,0)M=math.floor(M+u/100*Z[Y].health,0)L=cT+Z[Y].cd*x;if L>100 then L=100 end end end)RegisterNetEvent('esx:playerLoaded')AddEventHandler('esx:playerLoaded',function(ac)end)function GetInventoryItem(cV)while d==nil or d.inventory==nil do d=ESX.GetPlayerData()Wait(100)end;local cW=d.inventory;for a9=1,#cW,1 do if cW[a9].name==cV then return cW[a9]end end;return nil end;Citizen.CreateThread(function()while true do if#(GetEntityCoords(PlayerPedId())-vector3(-1893.0104980469,-1725.3708496094,-98.060005187988))<200 then SetPedMaxTimeUnderwater(PlayerPedId(),100.0)SetSwimMultiplierForPlayer(PlayerPedId(),1.49)else SetPedMaxTimeUnderwater(PlayerPedId(),10.0)end;Wait(5000)end end)Citizen.CreateThread(function()while true do ESX.TriggerServerCallback("Group:GetFaction",function(cX)Y=cX end)Wait(20000)end end)
