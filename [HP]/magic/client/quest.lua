local a={}local b="box"local c=nil;local d=nil;local e=nil;local f=nil;local g=[[ Ezennel elfoagom, hogy minden jutalmam, amely a szerződésből származott volna megszűnik. ]]local h={}local i=nil;Citizen.CreateThread(function()while i==nil do TriggerEvent("esx:getSharedObject",function(j)i=j end)Citizen.Wait(0)end end)function SyncQuests()i.TriggerServerCallback("Quest:GetQuests",function(k)a=k;for l,m in pairs(a)do local n=m.Text;if#m.Quests==0 then n="Nincs több feladatom a számodra"end;TriggerEvent("NPCs:CreateNPC",m.startCoords,m.heading,l,m.Model,n)local o=AddBlipForCoord(m.startCoords)SetBlipSprite(o,133)SetBlipDisplay(o,4)SetBlipScale(o,0.5)SetBlipColour(o,4)SetBlipAsShortRange(o,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString("???")EndTextCommandSetBlipName(o)end end)end;RegisterNetEvent("Quest:UpdateFromServer")AddEventHandler("Quest:UpdateFromServer",function()SyncQuests()end)function WaitESX()while i==nil do Wait(100)end end;local p={}local q={}Citizen.CreateThread(function()WaitESX()SyncQuests()end)AddEventHandler('esx:onPlayerSpawn',function(r)SyncQuests()end)Citizen.CreateThread(function()while true do Citizen.Wait(0)for s,t in pairs(a)do local u=GetEntityCoords(GetPlayerPed(-1),false)local v=Vdist(u,t.startCoords)if v<=2.0 then if not e and#t.Quests>0 then SetTextComponentFormat("STRING")AddTextComponentString('Nyomj ~INPUT_CONTEXT~-t a küldetéshez')DisplayHelpTextFromStringLabel(0,0,1,-1)elseif d==s then SetTextComponentFormat("TWOSTRINGS")AddTextComponentString(' Nyomj ~INPUT_CONTEXT~-t a küldetés leadásához~n~')AddTextComponentString('Nyomj ~INPUT_VEH_DUCK~-t a kültedés megszakításához')DisplayHelpTextFromStringLabel(0,0,1,-1)elseif#t.Quests>0 then SetTextComponentFormat("STRING")AddTextComponentString('Nyomj ~INPUT_CONTEXT~-t a küldetéshez')DisplayHelpTextFromStringLabel(0,0,1,-1)end;if IsControlJustPressed(0,38)and t.Quests[1]~=nil then f=t.Quests[1]c=s;if not e then TriggerEvent("Dialog:Open",t.Quests[1].Title,t.Quests[1].Text,"Quest")elseif d==s then TriggerServerEvent('Quest:ExchangeItems',d,e,false)else f=nil;TriggerEvent("Dialog:Open","Felmondólevél",g,"Quest")end end;if IsControlJustPressed(0,73)and e then f=nil;TriggerEvent("Dialog:Open","Felmondólevél",g,"Quest")end end end end end)function DeleteQuestBlips()for s,t in pairs(q)do RemoveBlip(t)end end;RegisterNetEvent("Quest:UpdateQuest")AddEventHandler("Quest:UpdateQuest",function(w)if w==nil then f=nil;c=nil;e=nil;d=nil;DeleteQuestBlips()DeleteLadak()else e=w;print(i.DumpTable(w))end end)RegisterNetEvent("Quest:Nui")AddEventHandler("Quest:Nui",function(m)if m and e and f==nil then e=nil;d=nil;c=nil;DeleteQuestBlips()DeleteLadak()else if m then e=f;d=c;CreateQuestLadak()TriggerServerEvent('Quest:SkipQuest',c,e)end end end)local x={}function CreateQuestLadak()for y,z in pairs(e.NeedToFindInBox)do local o=AddBlipForCoord(z.Coords)SetBlipSprite(o,478)SetBlipDisplay(o,4)SetBlipScale(o,0.9)SetBlipColour(o,46)SetBlipAsShortRange(o,false)BeginTextCommandSetBlipName("STRING")AddTextComponentString("Láda")EndTextCommandSetBlipName(o)x[y]={posx=z.Coords.x,posy=z.Coords.y,posz=z.Coords.z-1,blip=o}end;for s,t in pairs(x)do while not HasModelLoaded(GetHashKey(b))do RequestModel(GetHashKey(b))Wait(1)end;local A=CreateObjectNoOffset(GetHashKey(b),t.posx,t.posy,t.posz,false,true,false)x[s].object=A end;SetModelAsNoLongerNeeded(GetHashKey(b))end;function DeleteLadak()for s,t in pairs(x)do if t.object then DeleteObject(t.object)end;RemoveBlip(t.blip)x[s]=nil end end;function tablelength(B)local C=0;for D in pairs(B)do C=C+1 end;return C end;Citizen.CreateThread(function()local E=CreateRuntimeTxd('meows')local F=CreateRuntimeTextureFromImage(E,'woof','icon.png')while true do if e then local C=0;local G=C*0.03;if#e.NeedToKill>0 then local H="Ölj meg "..#e.NeedToKill.." entitást!"G=C*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.5)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(H)DrawText(0.80,0.15+G)DrawSprite('meows','woof',0.79,0.166+G,0.01,0.015,0.0,255,255,255,255)ClearDrawOrigin()C=C+1 end;for s,t in pairs(e.NeedToBring)do local H="Szerezz "..t.count.." "..t.label.." tárgyat!"G=C*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.5)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(H)DrawText(0.80,0.15+G)DrawSprite('meows','woof',0.79,0.166+G,0.01,0.015,0.0,255,255,255,255)ClearDrawOrigin()C=C+1 end;local I=tablelength(e.NeedToFindInBox)if I>0 then local H="Kutass át "..I.." ládát!"G=C*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.5)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(H)DrawText(0.80,0.15+G)DrawSprite('meows','woof',0.79,0.166+G,0.01,0.015,0.0,255,255,255,255)ClearDrawOrigin()C=C+1 end;if#q==0 and#e.NeedToKill>0 then for s,t in pairs(e.NeedToKill)do local o=AddBlipForCoord(t.coords)SetBlipSprite(o,84)SetBlipDisplay(o,4)SetBlipScale(o,0.9)SetBlipColour(o,1)SetBlipAsShortRange(o,false)SetModelAsNoLongerNeeded(model)table.insert(q,o)end end;if d~=nil and#e.NeedToBring>0 then local H="Térj vissza "..d.."-hoz!"G=C*0.03;SetTextFont(1)SetTextProportional(1)SetTextScale(0.0,0.5)SetTextColour(255,255,255,255)SetTextDropshadow(0,0,0,0,255)SetTextEdge(1,0,0,0,255)SetTextDropShadow()SetTextOutline()SetTextJustification(1)SetTextEntry("STRING")AddTextComponentString(H)DrawText(0.80,0.15+G)DrawSprite('meows','woof',0.79,0.166+G,0.01,0.015,0.0,255,255,255,255)ClearDrawOrigin()C=C+1 end;if#e.NeedToKill==0 and#q>0 then DeleteQuestBlips()end else Wait(1000)end;Wait(0)end end)Citizen.CreateThread(function()while true do if e then for s,t in pairs(e.NeedToKill)do if t.ped==nil or not DoesEntityExist(t.ped)and Vdist(GetEntityCoords(GetPlayerPed(-1)),t.coords.x,t.coords.y,t.coords.z)<t.area*3 then local model=GetHashKey(t.model)RequestModel(model)while not HasModelLoaded(model)do Citizen.Wait(1)end;local J=CreatePed(29,model,t.coords.x,t.coords.y,t.coords.z,t.heading,true,true)local K=NetworkGetNetworkIdFromEntity(J)SetOnline(K)SetPedRelationshipGroupHash(J,GetHashKey("AGGRESSIVE_INVESTIGATE"))SetEntityHealth(J,t.health)TaskCombatHatedTargetsInArea(J,t.coords,t.area,0)GiveWeaponToPed(J,GetHashKey(t.weapon),999,false,true)SetPedAccuracy(J,t.accuary)SetPedCanRagdollFromPlayerImpact(J,false)SetPedCanRagdoll(J,false)SetPedConfigFlag(J,430,true)SetPedConfigFlag(J,456,false)SetPedConfigFlag(J,294,true)SetPedDiesWhenInjured(J,false)e.NeedToKill[s]["ped"]=J;SetRelationshipBetweenGroups(5,GetHashKey('PLAYER'),GetHashKey("AGGRESSIVE_INVESTIGATE"))SetRelationshipBetweenGroups(5,GetHashKey("AGGRESSIVE_INVESTIGATE"),GetHashKey('PLAYER'))SetRelationshipBetweenGroups(0,GetHashKey("AGGRESSIVE_INVESTIGATE"),GetHashKey("AGGRESSIVE_INVESTIGATE"))elseif t.ped~=nil then if GetEntityHealth(t.ped)==0 then e.NeedToKill[s]["deathPosition"]=GetEntityCoords(t.ped)TriggerServerEvent('Quest:ExchangeItems',d,e,true)DeleteEntity(t.ped)e.NeedToKill[s].ped=nil elseif#(t.coords-GetEntityCoords(t.ped))>t.area*3 then TaskGoToCoordAnyMeans(t.ped,t.coords,2.0,0,false,786603,1.0)end end end end;Wait(5000)end end)Citizen.CreateThread(function()while true do if d~=nil and e~=nil then TriggerServerEvent('Quest:ExchangeItems',d,e,true)end;Wait(5000)end end)function SetOnline(K)SetNetworkIdExistsOnAllMachines(K,true)SetNetworkIdCanMigrate(K,true)end;function hintToDisplay(L)SetTextComponentFormat("STRING")AddTextComponentString(L)AddTextComponentString(L)DisplayHelpTextFromStringLabel(0,0,1,-1)end;AddEventHandler('esx_treasure:hasEnteredMarker',function(M,N)if LastZone=='containerzone'then CurrentAction='open_container'CurrentActionMsg='Nyomj ~INPUT_CONTEXT~-t a láda megszerzéséhez'CurrentActionData={zone=M}CurrentActionName=N end end)AddEventHandler('esx_treasure:hasExitedMarker',function(M)CurrentAction=nil;i.UI.Menu.CloseAll()end)Citizen.CreateThread(function()while x==nil do Citizen.Wait(500)end;while true do Wait(0)local O=GetEntityCoords(GetPlayerPed(-1))local P=false;local Q=nil;local R=nil;for S,t in pairs(x)do if GetDistanceBetweenCoords(O,t.posx,t.posy,t.posz,true)<3 then P=true;Q='containerzone'LastZone='containerzone'R=S end end;if P and not HasAlreadyEnteredMarker then HasAlreadyEnteredMarker=true;TriggerEvent('esx_treasure:hasEnteredMarker',Q,R)end;if not P and HasAlreadyEnteredMarker then HasAlreadyEnteredMarker=false;TriggerEvent('esx_treasure:hasExitedMarker',LastZone)end end end)Citizen.CreateThread(function()while x==nil do Citizen.Wait(500)end;while true do Citizen.Wait(0)if CurrentAction~=nil then SetTextComponentFormat('STRING')AddTextComponentString(CurrentActionMsg)DisplayHelpTextFromStringLabel(0,0,1,-1)if IsControlJustReleased(0,38)then if CurrentAction=='open_container'then for S,t in pairs(x)do if S==CurrentActionName then local T=GetClosestObjectOfType(t.posx,t.posy,t.posz,20.0,GetHashKey(b),true,false,false)PlaceObjectOnGroundProperly(T)DeleteEntity(T)RemoveBlip(t.blip)x[S]=nil;e.NeedToFindInBox[S]['delete']=true;TriggerServerEvent('Quest:ExchangeItems',d,e,true)end end end;CurrentAction=nil end end end end)Citizen.CreateThread(function()while x==nil do Citizen.Wait(500)end end)Citizen.CreateThread(function()while x==nil do Citizen.Wait(500)end;while true do Citizen.Wait(0)for S,t in pairs(x)do local U=vector3(t.posx,t.posy,t.posz+2.0)-vector3(t.posx,t.posy,t.posz)DrawSpotLight(t.posx,t.posy,t.posz,0.0,0.0,5.0,246,214,0,100.0,20.0,100.0,10.0,100.0)end end end)function GetCoordZHeroin(V,W)local X={10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,40.0,60.0,70.0,100.0,200.0,300.0,600.0}for S,Y in ipairs(X)do local Z,_=GetGroundZFor_3dCoord(V,W,Y)if Z then return _ end end;return 12.64 end
