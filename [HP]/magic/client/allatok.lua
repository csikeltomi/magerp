Citizen.CreateThread(function()while ESX==nil do TriggerEvent("esx:getSharedObject",function(a)ESX=a end)Citizen.Wait(0)end end)local b=100;local c={}local d={}local e={}AddEventHandler('onResourceStop',function(f)if f==GetCurrentResourceName()then for g=1,#d do local h=NetworkGetEntityFromNetworkId(c[g].netid)ESX.Game.DeleteObject(c[g].a)end end end)local i=1972614767;local j=2046537925;local k=1403091332;local l=GetHashKey('mp_f_freemode_01')local m=GetHashKey('mp_f_freemode_01')local n={GetHashKey('a_c_mtlion'),GetHashKey('a_c_boar'),GetHashKey('a_c_deer'),GetHashKey('a_c_coyote')}RegisterNetEvent('MagicAllatok:SyncNpcs')AddEventHandler('MagicAllatok:SyncNpcs',function(o)d=o;for p,q in pairs(d)do local h=NetworkGetEntityFromNetworkId(q.netid)d[p].netid=h end end)local s={}RegisterNetEvent('MagicAllatok:SyncSpawns')AddEventHandler('MagicAllatok:SyncSpawns',function(t)s=t;print(s.count)end)local u={"PLAYER","COP","SECURITY_GUARD","PRIVATE_SECURITY","GANG_1","GANG_2","GANG_9","GANG_10","AMBIENT_GANG_LOST","AMBIENT_GANG_MEXICAN","AMBIENT_GANG_FAMILY","AMBIENT_GANG_BALLAS","AMBIENT_GANG_MARABUNTE","AMBIENT_GANG_CULT","AMBIENT_GANG_SALVA","AMBIENT_GANG_WEICHENG","AMBIENT_GANG_HILLBILLY","DEALER","HATES_PLAYER","HEN","WILD_ANIMAL","COUGAR","NO_RELATIONSHIP","SPECIAL","MISSION2","MISSION3","MISSION4","MISSION5","MISSION6","MISSION7","MISSION8","GUARD_DOG","AGGRESSIVE_INVESTIGATE"}local v=5;Citizen.CreateThread(function()while true do Wait(50)for w,x in ipairs(u)do SetRelationshipBetweenGroups(v,GetHashKey('PLAYER'),GetHashKey(x))SetRelationshipBetweenGroups(v,GetHashKey(x),GetHashKey('PLAYER'))end end end)RegisterNetEvent('MagicAllatok:StartSpawn')AddEventHandler('MagicAllatok:StartSpawn',function(t,y)Citizen.CreateThread(function()s=t;local z=GetHashKey('a_c_mtlion')RequestModel(z)RequestModel(n[1])RequestModel(n[2])RequestModel(n[3])RequestModel(n[4])while not HasModelLoaded(z)do Citizen.Wait(1)end;local A=0;while s.count>0 do ESX.TriggerServerCallback("MagicAllatok:CanSpawn",function(B)print("SPAWN")s=B;if s.count>0 then local C=math.random(1,4)if s.fixAnimal then C=s.fixAnimal end;local D=GenerateHeroinCoords(s.coords,s.range)local E=CreatePed(29,n[C],D.x,D.y,D.z,90.0,true,true)local F=NetworkGetNetworkIdFromEntity(E)SetOnline(F)SetPedRelationshipGroupHash(E,GetHashKey("WILD_ANIMAL"))SetEntityHealth(E,500)local G=false;if s.area then TaskWanderInArea(E,s.coords,s.area,0.0,25000)TaskCombatHatedTargetsInArea(E,s.coords,s.area,0)G=true else end;local H={netid=F,r=s.aggressive_range,defaultTaskArea=G,coords=s.coords}table.insert(c,H)b=b-1;A=1;TriggerServerEvent('MagicAllatok:AddToArray',H,y,A)end end,y)Wait(500)end end)end)Citizen.CreateThread(function()TriggerServerEvent('MagicAllatok:StartSpawn')end)Citizen.CreateThread(function()while true do TriggerServerEvent('MagicAllatok:SyncNpcs')Citizen.Wait(2000)for g=1,#d,1 do if d[g].netid~=nil then local h=d[g].netid;local D=GetEntityCoords(h)local I=ESX.Game.GetPlayers(false)if GetEntityHealth(h)==0 then DeleteEntity(h)end;for J=1,#I do local K=GetPlayerPed(I[J])local L=GetEntityCoords(K)if Vdist(L,D)<d[g].r then if not d[g].defaultTaskArea then else TaskCombatHatedTargetsInArea(h,d[g].coords,d[g].area,0)end else TaskWanderInArea(h,d[g].coords,r,0.0,25000)end end end;Citizen.Wait(20)end end end)function GetCoordZHeroin(M,N)local O={10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,40.0,60.0,70.0,100.0,200.0,300.0}for g,P in ipairs(O)do local Q,R=GetGroundZFor_3dCoord(M,N,P)if Q then return R end end;return 12.64 end;function GenerateHeroinCoords(D,S)while true do Citizen.Wait(1)local T,U;math.randomseed(GetGameTimer())local V=math.random(S*-1,S)Citizen.Wait(100)math.randomseed(GetGameTimer())local W=math.random(S*-1,S)T=D.x+V;U=D.y+W;local X=GetCoordZHeroin(T,U)local Y=vector3(T,U,X)return Y end end;Citizen.CreateThread(function()end)function SetOnline(F)SetNetworkIdExistsOnAllMachines(F,true)SetNetworkIdCanMigrate(F,true)end
